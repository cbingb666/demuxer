{"version":3,"file":"demuxer.all.cjs.js","sources":["../src/enum/events.ts","../src/util/event-emitter.ts","../src/types/globals.ts","../src/util/is.ts","../src/util/cache-buffer.ts","../src/util/multi-map.ts","../src/util/event-manager.ts","../src/util/global.ts","../src/util/logger.ts","../src/util/stream.ts","../src/demux-facade.ts","../src/mux-error-code.ts","../src/util/dv.ts","../src/m2t/structs/patSection.ts","../src/m2t/structs/pmtSection.ts","../src/m2t/structs/sdtSection.ts","../src/enum/m2t-pid.ts","../src/m2t/psi.ts","../src/m2t/streams/complex.js","../src/util/platform.ts","../src/codec/aac/aac-config.ts","../src/codec/aac/aac.ts","../src/codec/adts.ts","../src/m2t/streams/adts.ts","../src/codec/avc/ep3b.ts","../src/util/exp-golumb.ts","../src/codec/avc/sps.ts","../src/codec/avc/pps.ts","../src/codec/avc/sei.ts","../src/codec/avc/nalu.ts","../src/codec/avc.ts","../src/codec/avc/avc-config.ts","../src/m2t/streams/avc.ts","../src/m2t/streams/elementary.ts","../src/m2t/structs/pes.ts","../src/m2t/streams/pes.ts","../src/m2t/structs/packet.ts","../src/m2t/demux.ts","../src/mp4/mp4-inspector.ts","../src/mp4/demux.ts"],"sourcesContent":["/**\n * @file= events.js, created at Monday, 23rd December 2019 3=47=23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nexport enum Events {\n\tERROR = 'ERROR',\n\tINFO = 'INFO',\n\tDATA = 'DATA',\n\tDEMUX_DATA = 'DEMUX_DATA',\n\tDONE = 'DONE'\n}\n","/**\n * @copyright https://github.com/nodejs/node/blob/master/lib/events.js\n */\n/* eslint-disable */\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar objectCreate = Object.create || objectCreatePolyfill;\nvar objectKeys = Object.keys || objectKeysPolyfill;\nvar bind = Function.prototype.bind || functionBindPolyfill;\n\n// By default Dispatchers will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nlet defaultMaxListeners = 10;\n\nexport default class EventEmitter {\n\tstatic listenerCount(emitter, type) {\n\t\tif (typeof emitter.listenerCount === 'function') {\n\t\t\treturn emitter.listenerCount(type);\n\t\t} else {\n\t\t\treturn listenerCount.call(emitter, type);\n\t\t}\n\t}\n\n\tstatic defaultMaxListeners: number;\n\n\t_maxListeners?: number;\n\t_eventsCount: number;\n\t_events: any;\n\n\tconstructor() {\n\t\tif (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {\n\t\t\tthis._events = objectCreate(null);\n\t\t\tthis._eventsCount = 0;\n\t\t}\n\n\t\tthis._maxListeners = this._maxListeners || undefined;\n\t}\n\n\t// // Obviously not all Emitters should be limited to 10. This function allows\n\t// // that to be increased. Set to zero for unlimited.\n\t// setMaxListeners(n) {\n\t//     if (typeof n !== 'number' || n < 0 || isNaN(n))\n\t//         throw new TypeError('\"n\" argument must be a positive number');\n\t//     this._maxListeners = n;\n\t//     return this;\n\t// }\n\t//\n\t// getMaxListeners() {\n\t//     return $getMaxListeners(this);\n\t// }\n\n\temit(type: string, ...rest) {\n\t\tvar er, handler, len, args, i, events;\n\t\tvar doError = type === 'error';\n\n\t\tevents = this._events;\n\t\tif (events) doError = doError && events.error == null;\n\t\telse if (!doError) return false;\n\n\t\t// If there is no 'error' event listener then throw.\n\t\tif (doError) {\n\t\t\tif (arguments.length > 1) er = arguments[1];\n\t\t\tif (er instanceof Error) {\n\t\t\t\tthrow er; // Unhandled 'error' event\n\t\t\t} else {\n\t\t\t\t// At least give some kind of context to the user\n\t\t\t\tvar err = new Error('Unhandled \"error\" event. (' + er + ')');\n\t\t\t\terr['context'] = er;\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\n\t\thandler = events[type];\n\n\t\tif (!handler) return false;\n\n\t\tvar isFn = typeof handler === 'function';\n\t\tlen = arguments.length;\n\t\tswitch (len) {\n\t\t\t// fast cases\n\t\t\tcase 1:\n\t\t\t\temitNone(handler, isFn, this);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\temitOne(handler, isFn, this, arguments[1]);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\temitTwo(handler, isFn, this, arguments[1], arguments[2]);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\temitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n\t\t\t\tbreak;\n\t\t\t// slower\n\t\t\tdefault:\n\t\t\t\targs = new Array(len - 1);\n\t\t\t\tfor (i = 1; i < len; i++) args[i - 1] = arguments[i];\n\t\t\t\temitMany(handler, isFn, this, args);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\ton(type: string, listener: Function) {\n\t\treturn _addListener(this, type, listener);\n\t}\n\n\tonce(type, listener) {\n\t\tif (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\n\t\tthis.on(type, _onceWrap(this, type, listener));\n\t\treturn this;\n\t}\n\n\toff(type, listener) {\n\t\treturn _removeListener.call(this, type, listener);\n\t}\n\n\tremoveAllListeners(type) {\n\t\tvar listeners, events, i;\n\n\t\tevents = this._events;\n\t\tif (!events) return this;\n\n\t\t// not listening for off, no need to emit\n\t\tif (!events.off) {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\tthis._events = objectCreate(null);\n\t\t\t\tthis._eventsCount = 0;\n\t\t\t} else if (events[type]) {\n\t\t\t\tif (--this._eventsCount === 0) this._events = objectCreate(null);\n\t\t\t\telse delete events[type];\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\n\t\t// emit off for all listeners on all events\n\t\tif (arguments.length === 0) {\n\t\t\tvar keys = objectKeys(events);\n\t\t\tvar key;\n\t\t\tfor (i = 0; i < keys.length; ++i) {\n\t\t\t\tkey = keys[i];\n\t\t\t\tif (key === 'off') continue;\n\t\t\t\tthis.removeAllListeners(key);\n\t\t\t}\n\t\t\tthis.removeAllListeners('off');\n\t\t\tthis._events = objectCreate(null);\n\t\t\tthis._eventsCount = 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tlisteners = events[type];\n\n\t\tif (typeof listeners === 'function') {\n\t\t\tthis.off(type, listeners);\n\t\t} else if (listeners) {\n\t\t\t// LIFO order\n\t\t\tfor (i = listeners.length - 1; i >= 0; i--) {\n\t\t\t\tthis.off(type, listeners[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tlisteners(type) {\n\t\treturn _listeners(this, type, true);\n\t}\n\n\trawListeners(type) {\n\t\treturn _listeners(this, type, false);\n\t}\n\n\tlistenerCount() {\n\t\treturn EventEmitter.listenerCount.apply(this, arguments);\n\t}\n}\n\nlet hasDefineProperty;\ntry {\n\tvar o = {};\n\tif (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });\n\thasDefineProperty = o['x'] === 0;\n} catch (err) {\n\thasDefineProperty = false;\n}\nif (hasDefineProperty) {\n\tObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n\t\tenumerable: true,\n\t\tget: function () {\n\t\t\treturn defaultMaxListeners;\n\t\t},\n\t\tset: function (arg) {\n\t\t\t// check whether the input is a positive number (whose value is zero or\n\t\t\t// greater and not a NaN).\n\t\t\tif (typeof arg !== 'number' || arg < 0 || arg !== arg)\n\t\t\t\tthrow new TypeError('\"defaultMaxListeners\" must be a positive number');\n\t\t\tdefaultMaxListeners = arg;\n\t\t}\n\t});\n} else {\n\tEventEmitter.defaultMaxListeners = defaultMaxListeners;\n}\n\nfunction $getMaxListeners(that) {\n\tif (that._maxListeners === undefined) return EventEmitter.defaultMaxListeners;\n\treturn that._maxListeners;\n}\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n\tif (isFn) handler.call(self);\n\telse {\n\t\tvar len = handler.length;\n\t\tvar listeners = arrayClone(handler, len);\n\t\tfor (var i = 0; i < len; ++i) {\n\t\t\ttry {\n\t\t\t\tlisteners[i].call(self);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction emitOne(handler, isFn, self, arg1) {\n\tif (isFn) handler.call(self, arg1);\n\telse {\n\t\tvar len = handler.length;\n\t\tvar listeners = arrayClone(handler, len);\n\t\tfor (var i = 0; i < len; ++i) {\n\t\t\ttry {\n\t\t\t\tlisteners[i].call(self, arg1);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n\tif (isFn) handler.call(self, arg1, arg2);\n\telse {\n\t\tvar len = handler.length;\n\t\tvar listeners = arrayClone(handler, len);\n\t\tfor (var i = 0; i < len; ++i) {\n\t\t\ttry {\n\t\t\t\tlisteners[i].call(self, arg1, arg2);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n\tif (isFn) handler.call(self, arg1, arg2, arg3);\n\telse {\n\t\tvar len = handler.length;\n\t\tvar listeners = arrayClone(handler, len);\n\t\tfor (var i = 0; i < len; ++i) {\n\t\t\ttry {\n\t\t\t\tlisteners[i].call(self, arg1, arg2, arg3);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction emitMany(handler, isFn, self, args) {\n\tif (isFn) handler.apply(self, args);\n\telse {\n\t\tvar len = handler.length;\n\t\tvar listeners = arrayClone(handler, len);\n\t\tfor (var i = 0; i < len; ++i) {\n\t\t\ttry {\n\t\t\t\tlisteners[i].apply(self, args);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction _addListener(target: EventEmitter, type, listener: Function) {\n\tvar m;\n\tvar events;\n\tvar existing;\n\n\tif (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\n\n\tevents = target._events;\n\tif (!events) {\n\t\tevents = target._events = objectCreate(null);\n\t\ttarget._eventsCount = 0;\n\t} else {\n\t\t// To avoid recursion in the case that type === \"newListener\"! Before\n\t\t// adding it to the listeners, first emit \"newListener\".\n\t\tif (events.newListener) {\n\t\t\ttarget.emit('newListener', type, listener['listener'] ? listener['listener'] : listener);\n\n\t\t\t// Re-assign `events` because a newListener handler could have caused the\n\t\t\t// this._events to be assigned to a new object\n\t\t\tevents = target._events;\n\t\t}\n\t\texisting = events[type];\n\t}\n\n\tif (!existing) {\n\t\t// Optimize the case of one listener. Don't need the extra array object.\n\t\texisting = events[type] = listener;\n\t\t++target._eventsCount;\n\t} else {\n\t\tif (typeof existing === 'function') {\n\t\t\t// Adding the second element, need to change to array.\n\t\t\texisting = events[type] = [existing, listener];\n\t\t} else {\n\t\t\texisting.push(listener);\n\t\t}\n\n\t\t// Check for listener leak\n\t\tif (!existing.warned) {\n\t\t\tm = $getMaxListeners(target);\n\t\t\tif (m && m > 0 && existing.length > m) {\n\t\t\t\texisting.warned = true;\n\n\t\t\t\tclass CustomError extends Error {\n\t\t\t\t\temitter: any;\n\t\t\t\t\ttype: string;\n\t\t\t\t\tcount: number;\n\t\t\t\t}\n\t\t\t\tlet w: CustomError = new CustomError(\n\t\t\t\t\t'Possible Dispatcher memory leak detected. ' +\n\t\t\t\t\t\texisting.length +\n\t\t\t\t\t\t' \"' +\n\t\t\t\t\t\tString(type) +\n\t\t\t\t\t\t'\" listeners ' +\n\t\t\t\t\t\t'added. Use emitter.setMaxListeners() to ' +\n\t\t\t\t\t\t'increase limit.'\n\t\t\t\t);\n\t\t\t\tw.name = 'MaxListenersExceededWarning';\n\t\t\t\tw.emitter = target;\n\t\t\t\tw.type = type;\n\t\t\t\tw.count = existing.length;\n\n\t\t\t\tif (typeof console === 'object' && console.warn) {\n\t\t\t\t\tconsole.warn('%s: %s', w.name, w.message);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn target;\n}\n\nfunction _removeListener(type, listener) {\n\tvar list, events, position, i, originalListener;\n\n\tif (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\n\n\tevents = this._events;\n\tif (!events) return this;\n\n\tlist = events[type];\n\tif (!list) return this;\n\n\tif (list === listener || list.listener === listener) {\n\t\tif (--this._eventsCount === 0) this._events = objectCreate(null);\n\t\telse {\n\t\t\tdelete events[type];\n\t\t\tif (events.off) this.emit('off', type, list.listener || listener);\n\t\t}\n\t} else if (typeof list !== 'function') {\n\t\tposition = -1;\n\n\t\tfor (i = list.length - 1; i >= 0; i--) {\n\t\t\tif (list[i] === listener || list[i].listener === listener) {\n\t\t\t\toriginalListener = list[i].listener;\n\t\t\t\tposition = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (position < 0) return this;\n\n\t\tif (position === 0) list.shift();\n\t\telse spliceOne(list, position);\n\n\t\tif (list.length === 1) events[type] = list[0];\n\n\t\tif (events.off) this.emit('off', type, originalListener || listener);\n\t}\n\n\treturn this;\n}\n\nfunction onceWrapper() {\n\tif (!this.fired) {\n\t\tthis.target.off(this.type, this.wrapFn);\n\t\tthis.fired = true;\n\t\tswitch (arguments.length) {\n\t\t\tcase 0:\n\t\t\t\treturn this.listener.call(this.target);\n\t\t\tcase 1:\n\t\t\t\treturn this.listener.call(this.target, arguments[0]);\n\t\t\tcase 2:\n\t\t\t\treturn this.listener.call(this.target, arguments[0], arguments[1]);\n\t\t\tcase 3:\n\t\t\t\treturn this.listener.call(this.target, arguments[0], arguments[1], arguments[2]);\n\t\t\tdefault:\n\t\t\t\tvar args = new Array(arguments.length);\n\t\t\t\tfor (var i = 0; i < args.length; ++i) args[i] = arguments[i];\n\t\t\t\tthis.listener.apply(this.target, args);\n\t\t}\n\t}\n}\n\nfunction _onceWrap(target, type, listener) {\n\tvar state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n\tvar wrapped = bind.call(onceWrapper, state);\n\twrapped.listener = listener;\n\tstate.wrapFn = wrapped;\n\treturn wrapped;\n}\n\nfunction _listeners(target, type, unwrap) {\n\tvar events = target._events;\n\n\tif (!events) return [];\n\n\tvar evlistener = events[type];\n\tif (!evlistener) return [];\n\n\tif (typeof evlistener === 'function') return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n\treturn unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nfunction listenerCount(type) {\n\tvar events = this._events;\n\n\tif (events) {\n\t\tvar evlistener = events[type];\n\n\t\tif (typeof evlistener === 'function') {\n\t\t\treturn 1;\n\t\t} else if (evlistener) {\n\t\t\treturn evlistener.length;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n\tfor (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1) list[i] = list[k];\n\tlist.pop();\n}\n\nfunction arrayClone(arr, n) {\n\tvar copy = new Array(n);\n\tfor (var i = 0; i < n; ++i) copy[i] = arr[i];\n\treturn copy;\n}\n\nfunction unwrapListeners(arr) {\n\tvar ret = new Array(arr.length);\n\tfor (var i = 0; i < ret.length; ++i) {\n\t\tret[i] = arr[i].listener || arr[i];\n\t}\n\treturn ret;\n}\n\nfunction objectCreatePolyfill(proto) {\n\tvar F = function () {};\n\tF.prototype = proto;\n\treturn new F();\n}\n\nfunction objectKeysPolyfill(obj) {\n\tvar keys = [];\n\tfor (var k in obj)\n\t\tif (Object.prototype.hasOwnProperty.call(obj, k)) {\n\t\t\tkeys.push(k);\n\t\t}\n\treturn k;\n}\n\nfunction functionBindPolyfill(context) {\n\tvar fn = this;\n\treturn function () {\n\t\treturn fn.apply(context, arguments);\n\t};\n}\n","import EventEmitter from '../util/event-emitter';\n\nexport class Context extends EventEmitter {}\n\nexport type PushConf = Partial<{\n\tdone: boolean;\n\tstubTime: number;\n\toffsetPos: number; // Represents the start byte of the pushed data relative to the entire file\n}>;\n\nexport type GlobalOptions = Partial<{\n\tdebug: boolean;\n\tdecodeCodec: boolean;\n\tconfig: PushConf;\n}>;\n\nexport interface IDemux {\n\t/**\n\t * Pipe the arrayBuffer to the demuxer.\n\t * @param buf\n\t * @param conf\n\t */\n\tpush(buf: ArrayBuffer | Uint8Array, conf: PushConf): void;\n\n\treset(): void;\n\n\tdestroy(): void;\n}\n","/**\n * @file: is.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = Object.prototype.toString;\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nexport function isObjectLike(value: any): boolean {\n\treturn !!value && typeof value == 'object';\n}\n\nexport function isEmptyObject(obj: object): boolean {\n\tfor (var prop in obj) {\n\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn JSON.stringify(obj) === JSON.stringify({});\n}\n\n/**\n * @param url\n */\nexport function isHttps(url?: string): boolean {\n\treturn /^https/gi.test(url || window.location.protocol);\n}\n\n/**\n * @param num\n */\nexport function isNumber(num: any): boolean {\n\treturn typeof num === 'number' && !isNaN(num);\n}\n\n/**\n * @param value\n */\nexport function isArrayBuffer(value: any): boolean {\n\treturn isObjectLike(value) && objectToString.call(value).toLowerCase() === '[object arraybuffer]';\n}\n\n/**\n * @param value\n */\nexport function isUint8Array(value: any): boolean {\n\treturn isObjectLike(value) && objectToString.call(value).toLowerCase() === '[object uint8array]';\n}\n","/**\n * @file: cache-buffer.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport { isNumber } from './is';\n\n/**\n * Cache Buffer util.\n * It's applicable for streaming data cutting and retaining the data,\n * the algorithm minimizes memory application as much as possible.\n */\n\nexport default class CacheBuffer {\n\tget byteLength(): number {\n\t\tif (!isNumber(this.byteLength_)) {\n\t\t\tlet len = 0;\n\n\t\t\tfor (let i = 0, item: Uint8Array; i < this.list_.length; i++) {\n\t\t\t\titem = this.list_[i];\n\t\t\t\tlen += item.byteLength;\n\t\t\t}\n\t\t\tthis.byteLength_ = len;\n\t\t}\n\n\t\treturn this.byteLength_;\n\t}\n\n\t/**\n\t * maybe return new allocated memory or original memory\n\t */\n\tget bytes(): Uint8Array | null {\n\t\tconst { bufferList } = this;\n\t\tlet bytes = null;\n\n\t\tif (bufferList.length > 0) {\n\t\t\tif (bufferList.length === 0) {\n\t\t\t\tbytes = bufferList[0];\n\t\t\t} else {\n\t\t\t\tbytes = this.toNewBytes();\n\t\t\t}\n\t\t}\n\n\t\treturn bytes;\n\t}\n\n\tget empty() {\n\t\treturn this.list_.length === 0;\n\t}\n\n\tget bufferList() {\n\t\treturn this.list_;\n\t}\n\n\t/**\n\t * Used to cache calculations, reduce the number of CPU calculations.\n\t * When internal data changes, the value needs to be cleared and recalculated.\n\t */\n\tprivate byteLength_: number | null;\n\n\tprivate list_: Array<Uint8Array> = [];\n\n\tclear() {\n\t\tlet len = this.list_.length;\n\t\tif (len > 0) {\n\t\t\tthis.list_.splice(0, len);\n\t\t}\n\t\tthis.byteLength_ = null;\n\t}\n\n\ttoNewBytes(): Uint8Array | null {\n\t\tlet bytes = null;\n\t\tlet tryCount: number = 0;\n\t\tlet maxTryCount: number = 50;\n\n\t\t// The following retry strategies are provided for failed memory applications\n\t\t// In terms of a better strategy, a failed memory application retry should be\n\t\t// an asynchronous process, which does not return until the application succeeds.\n\t\t// But the original design of the library is synchronous.\n\t\twhile (bytes === null) {\n\t\t\ttry {\n\t\t\t\ttryCount++;\n\t\t\t\tbytes = new Uint8Array(this.byteLength);\n\t\t\t} catch (e) {\n\t\t\t\tif (tryCount > maxTryCount) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0, offset = 0; i < this.list_.length; i++) {\n\t\t\tlet payload = this.list_[i];\n\n\t\t\tbytes.set(payload, offset);\n\t\t\toffset += payload.byteLength;\n\t\t}\n\n\t\treturn bytes;\n\t}\n\n\tappend(newBuffer: Uint8Array | CacheBuffer): void {\n\t\tif (newBuffer instanceof CacheBuffer) {\n\t\t\tthis.list_ = this.list_.concat(newBuffer.bufferList);\n\t\t} else {\n\t\t\tthis.list_.push(newBuffer);\n\t\t}\n\n\t\tthis.byteLength_ = null;\n\t}\n\n\t/**\n\t * This function cuts a complete TypedArray from CacheBuffer and retains the remainder of CacheBuffer.\n\t * The following points should be noted when using this function:\n\t * 1. If the cut needs to return the cut-out part, the cut length should be as small as possible to reduce the errors in memory application.\n\t * 2. If the cutting is only to preserve the remaining parts, the cutting size is within the total number of bytes, without considering memory applications.\n\t * @param {number} fixedLength\n\t * @param {boolean} [needCutResult] - If not, just retain the remaining parts after cutting.\n\t */\n\tcut(fixedLength: number, needCutResult: boolean = true): Uint8Array {\n\t\tlet chunk = null;\n\n\t\tif (fixedLength > 0 && !this.empty) {\n\t\t\tlet list = this.list_;\n\n\t\t\tlet offset = 0;\n\t\t\tlet loopIndex = 0;\n\n\t\t\twhile (list.length > 0) {\n\t\t\t\tlet cur = list.shift();\n\n\t\t\t\tif (loopIndex === 0) {\n\t\t\t\t\tif (cur.byteLength >= fixedLength) {\n\t\t\t\t\t\tif (needCutResult) {\n\t\t\t\t\t\t\t// Here is the key point for optimize memory alloc\n\t\t\t\t\t\t\tchunk = cur.subarray(0, fixedLength);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cur.byteLength > fixedLength) {\n\t\t\t\t\t\t\tcur = cur.subarray(fixedLength);\n\t\t\t\t\t\t\tlist.unshift(cur);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (needCutResult) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tchunk = new Uint8Array(fixedLength);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tthrow `alloc_memory_error@ cache buffer: ${fixedLength} ${e.message}`;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tchunk.set(cur, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\toffset += cur.byteLength;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet subLen = fixedLength - offset;\n\n\t\t\t\t\tif (cur.byteLength >= subLen) {\n\t\t\t\t\t\tif (needCutResult) {\n\t\t\t\t\t\t\tchunk.set(cur.subarray(0, subLen), offset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcur = cur.subarray(subLen);\n\n\t\t\t\t\t\tif (cur.byteLength > 0) {\n\t\t\t\t\t\t\tlist.unshift(cur);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (needCutResult) {\n\t\t\t\t\t\t\tchunk.set(cur, offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t\toffset += cur.byteLength;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tloopIndex++;\n\t\t\t}\n\n\t\t\tthis.byteLength_ = null;\n\t\t}\n\n\t\treturn chunk;\n\t}\n}\n","/**\n * @fileOverview A simple multimap template.\n */\n\ninterface MapData {\n\t[index: string]: Array<any>;\n}\n\nexport default class MultiMap {\n\tprivate map_: MapData;\n\n\tconstructor() {\n\t\tthis.map_ = {};\n\t}\n\n\t/**\n\t * Add a key, value pair to the map.\n\t * @param key\n\t * @param value\n\t */\n\tpush(key: string, value: any) {\n\t\tif (this.map_.hasOwnProperty(key)) {\n\t\t\tthis.map_[key].push(value);\n\t\t} else {\n\t\t\tthis.map_[key] = [value];\n\t\t}\n\t}\n\n\t/**\n\t * Get a list of values by key.\n\t * @param key\n\t */\n\tget(key: string): Array<any> {\n\t\tlet list = this.map_[key];\n\t\t// slice() clones the list so that it and the map can each be modified\n\t\t// without affecting the other.\n\t\treturn list ? list.slice() : null;\n\t}\n\n\t/**\n\t * Get a list of all values.\n\t */\n\tgetAll(): Array<any> {\n\t\tlet list = [];\n\t\tfor (let key in this.map_) {\n\t\t\tlist.push.apply(list, this.map_[key]);\n\t\t}\n\t\treturn list;\n\t}\n\n\t/**\n\t * Remove a specific value, if it exists.\n\t * @param key\n\t * @param value\n\t */\n\tremove(key: string, value: any): void {\n\t\tlet list = this.map_[key];\n\t\tif (list) {\n\t\t\tfor (let i = 0; i < list.length; ++i) {\n\t\t\t\tif (list[i] == value) {\n\t\t\t\t\tlist.splice(i, 1);\n\t\t\t\t\t--i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear all keys and values from the multimap.\n\t */\n\tclear(): void {\n\t\tthis.map_ = {};\n\t}\n\n\t/**\n\t * @param callback\n\t */\n\tforEach(callback: Function): void {\n\t\tfor (let key in this.map_) {\n\t\t\tcallback(key, this.map_[key]);\n\t\t}\n\t}\n}\n","import MultiMap from './multi-map';\n\n/**\n * Creates a new Binding_ and attaches the event listener to the event target.\n */\nclass Binding_ {\n\ttarget: any;\n\ttype: string;\n\tlistener: Function;\n\n\t/**\n\t * @param target - The event target.\n\t * @param type - The event type.\n\t * @param listener - The event listener.\n\t */\n\tconstructor(target: any, type: string, listener: Function) {\n\t\tthis.target = target;\n\t\tthis.type = type;\n\t\tthis.listener = listener;\n\n\t\tif (this.target.addEventListener) {\n\t\t\tthis.target.addEventListener(type, listener, false);\n\t\t} else if (this.target.on) {\n\t\t\tthis.target.on(type, listener, false);\n\t\t}\n\t}\n\n\t/**\n\t * Detaches the event listener from the event target.\n\t * This does nothing if the event listener is already detached.\n\t */\n\toff() {\n\t\tif (this.target.removeEventListener) {\n\t\t\tthis.target.removeEventListener(this.type, this.listener, false);\n\t\t} else if (this.target.off) {\n\t\t\tthis.target.off(this.type, this.listener, false);\n\t\t}\n\n\t\tthis.target = null;\n\t\tthis.listener = null;\n\t}\n}\n\n/**\n * Creates a new EventManager.\n * An EventManager maintains a collection of \"event bindings\" between event targets and event listeners.\n */\nexport default class EventManager {\n\tprivate bindingMap_: MultiMap;\n\t// static Binding_: Binding;\n\n\tconstructor() {\n\t\t/**\n\t\t * Maps an event type to an array of event bindings.\n\t\t */\n\t\tthis.bindingMap_ = new MultiMap();\n\t}\n\n\t/**\n\t * Detaches all event listeners.\n\t * @override\n\t */\n\tdestroy(): void {\n\t\tthis.removeAll();\n\t\tthis.bindingMap_ = null;\n\t}\n\n\t/**\n\t * Attaches an event listener to an event target.\n\t * @param target - The event target.\n\t * @param type  - The event type.\n\t * @param listener  - The event listener.\n\t */\n\ton(target: any, type: string, listener: Function): EventManager {\n\t\tif (!this.bindingMap_) return;\n\n\t\tlet binding = new Binding_(target, type, listener);\n\t\tthis.bindingMap_.push(type, binding);\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Attaches an event listener to an event target.\n\t * The listener will be removed when the first instance of the event is fired.\n\t * @param {EventTarget} target The event target.\n\t * @param {string} type The event type.\n\t * @param {function} listener The event listener.\n\t */\n\tonce(target: any, type: string, listener: Function) {\n\t\t// Install a shim listener that will stop listening after the first event.\n\t\tthis.on(\n\t\t\ttarget,\n\t\t\ttype,\n\t\t\tfunction (event: any) {\n\t\t\t\t// Stop listening to this event.\n\t\t\t\tthis.off(target, type);\n\t\t\t\t// Call the original listener.\n\t\t\t\tlistener(event);\n\t\t\t}.bind(this)\n\t\t);\n\t}\n\n\t/**\n\t * Detaches an event listener from an event target.\n\t * @param {EventTarget} target The event target.\n\t * @param {string} type The event type.\n\t */\n\toff(target: any, type: string): void {\n\t\tif (!this.bindingMap_) return;\n\n\t\tlet list = this.bindingMap_.get(type) || [];\n\n\t\tfor (let i = 0; i < list.length; ++i) {\n\t\t\tlet binding = list[i];\n\n\t\t\tif (binding.target == target) {\n\t\t\t\tbinding.off();\n\t\t\t\tthis.bindingMap_.remove(type, binding);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Detaches all event listeners from all targets.\n\t */\n\tremoveAll(): void {\n\t\tif (!this.bindingMap_) return;\n\n\t\tlet list = this.bindingMap_.getAll();\n\n\t\tfor (let i = 0; i < list.length; ++i) {\n\t\t\tlist[i].off();\n\t\t}\n\n\t\tthis.bindingMap_.clear();\n\t}\n}\n\n// EventManager.Binding_ = Binding;\n","/**\n * @file: global.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * @description provide global scope.\n */\nlet global: any;\n\n// see https://stackoverflow.com/a/11237259/589493\nif (typeof window === 'undefined') {\n\t/* eslint-disable-next-line no-undef */\n\tglobal = self;\n} else {\n\tglobal = window;\n}\n\nexport default global;\n","/**\n * @file: logger.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * utils - logger\n */\n/* global WorkerGlobalScope */\nimport global from './global';\nimport EventEmitter from './event-emitter';\n\nlet console = global.console;\nconst isWorker =\n\ttypeof WorkerGlobalScope !== 'undefined' &&\n\tself instanceof WorkerGlobalScope &&\n\ttypeof importScripts != 'undefined';\nconst prefix = '>>>';\n\nclass Logger extends EventEmitter {\n\tprivate MSG_NAME: string;\n\tprivate _enable: boolean;\n\n\tget enable() {\n\t\treturn this._enable;\n\t}\n\n\tset enable(value: boolean) {\n\t\tthis._enable = value;\n\n\t\tthis.MSG_NAME = '__log__';\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._enable = false;\n\t}\n\n\tlog(...restArgs: any) {\n\t\tif (isWorker) {\n\t\t\tlogger.emit(this.MSG_NAME, 'log', [...arguments].join(''));\n\t\t} else {\n\t\t\tif (this._enable) {\n\t\t\t\tconsole.log.call(console, prefix, ...arguments);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug(...restArgs: any) {\n\t\tif (isWorker) {\n\t\t\tlogger.emit(this.MSG_NAME, 'debug', [...arguments].join(''));\n\t\t} else {\n\t\t\tif (this._enable && console.debug) {\n\t\t\t\tconsole.debug.call(console, prefix, ...arguments);\n\t\t\t}\n\t\t}\n\t}\n\n\tassert(...restArgs: any) {\n\t\tif (this._enable && console.assert) {\n\t\t\tlet condition = arguments[0];\n\t\t\tlet sliceArgs = Array.prototype.slice.call(arguments, 1);\n\t\t\tsliceArgs.unshift(prefix);\n\n\t\t\tconsole.assert.call(console, condition, ...sliceArgs);\n\t\t}\n\t}\n\n\twarn(...restArgs: any) {\n\t\tif (isWorker) {\n\t\t\tlogger.emit(this.MSG_NAME, 'warn', [...arguments].join(''));\n\t\t} else {\n\t\t\tif (this._enable) {\n\t\t\t\tconsole.warn.call(console, prefix, ...arguments);\n\t\t\t}\n\t\t}\n\t}\n\n\terror(...restArgs: any) {\n\t\tif (isWorker) {\n\t\t\tlogger.emit(this.MSG_NAME, 'error', [...arguments].join(''));\n\t\t} else {\n\t\t\tif (this._enable) {\n\t\t\t\tconsole.error.call(console, prefix, ...arguments);\n\t\t\t}\n\t\t}\n\t}\n}\n\nlet logger = new Logger();\n\n/**\n * @param {Object} obj - custom logger\n */\nexport function setLogger(obj) {\n\tconsole = obj;\n}\n\nexport function getLogger() {\n\treturn logger;\n}\n\nexport default logger;\n","/**\n * @file: stream.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * simple stream implementation.\n */\n\nimport { PushConf } from '../types/globals';\nimport EventEmitter from './event-emitter';\n\nclass Stream extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t/**\n\t * connect to the next pipeline stream.\n\t * @param destination\n\t */\n\tpipe(destination: Stream): Stream {\n\t\tthis.on('reset', function () {\n\t\t\tdestination.reset();\n\t\t});\n\n\t\tthis.on('data', function (data) {\n\t\t\tdestination.push(data);\n\t\t});\n\n\t\tthis.on('done', function (flushSource) {\n\t\t\tdestination.flush(flushSource);\n\t\t});\n\n\t\treturn destination;\n\t}\n\n\t/**\n\t * detaches the next pipeline stream previously attached.\n\t */\n\tunpipe(): Stream {\n\t\tthis.removeAllListeners('reset');\n\t\tthis.removeAllListeners('data');\n\t\tthis.removeAllListeners('done');\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * push data to current pipeline.\n\t * @param data\n\t */\n\tpush(data: any, conf?: PushConf): void {\n\t\tthis.emit('data', data);\n\t}\n\n\t/**\n\t * flush current pipeline.\n\t * @param flushSource\n\t */\n\tflush(flushSource: Stream): void {\n\t\tthis.emit('done', flushSource);\n\t}\n\n\treset(): void {\n\t\tthis.emit('reset');\n\t}\n}\n\nexport default Stream;\n","/**\n * @file: demuxer.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\nimport { Events } from './enum/events';\nimport { Context, GlobalOptions, IDemux, PushConf } from './types/globals';\nimport CacheBuffer from './util/cache-buffer';\nimport EventManager from './util/event-manager';\nimport { isArrayBuffer, isUint8Array } from './util/is';\nimport logger from './util/logger';\nimport Stream from './util/stream';\n\nexport default abstract class DemuxFacade extends Stream implements IDemux {\n\treadonly endStream?: Stream;\n\tprotected eventManager_: EventManager;\n\tprotected ctx_: Context;\n\tprotected options_: GlobalOptions;\n\tprotected cache_buffer_: CacheBuffer;\n\n\tprotected listenEndStream_(): void {\n\t\tthis.eventManager_ = new EventManager();\n\n\t\tthis.eventManager_\n\t\t\t.on(this.endStream, 'data', (data) => {\n\t\t\t\tthis.emit(Events.DEMUX_DATA, data);\n\t\t\t})\n\t\t\t.on(this.endStream, 'done', (data) => {\n\t\t\t\tthis.emit(Events.DONE, data);\n\t\t\t})\n\t\t\t.on(this.ctx_, 'error', (data) => {\n\t\t\t\tthis.emit(Events.ERROR, data);\n\t\t\t});\n\t}\n\n\tconstructor(options: GlobalOptions = {}) {\n\t\tsuper();\n\n\t\tif (options.debug) {\n\t\t\tlogger.enable = true;\n\t\t}\n\n\t\tthis.ctx_ = new Context();\n\t\tthis.options_ = options;\n\t\tthis.cache_buffer_ = new CacheBuffer();\n\t}\n\n\t/**\n\t * Pipe the arrayBuffer to the demuxer.\n\t * @param buf\n\t * @param conf\n\t */\n\tabstract push(buf: ArrayBuffer | Uint8Array, conf: PushConf): void;\n\n\t/**\n\t * transfer data to Uint8Array\n\t * @param buf\n\t */\n\tprotected constraintPushData_(buf: ArrayBuffer | Uint8Array): Uint8Array | null {\n\t\tlet newBuf = null;\n\t\tif (!isArrayBuffer(buf) && !isUint8Array(buf)) {\n\t\t\treturn newBuf;\n\t\t}\n\n\t\tif (isArrayBuffer(buf)) {\n\t\t\tnewBuf = new Uint8Array(buf);\n\t\t}\n\n\t\treturn newBuf;\n\t}\n\n\treset(): void {}\n\n\tdestroy(): void {\n\t\tthis.unpipe();\n\t\tthis.endStream.unpipe();\n\n\t\tthis.eventManager_.removeAll();\n\t}\n}\n","/**\n * @file: mux-error-code.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * @readonly\n * @enum {Number}\n */\nenum codes {\n\tWORKER_EXCEPTION = 0,\n\tWORKER_MSG_EXCEPTION,\n\tTS_SYNC_BYTE,\n\tFLV_HEAD_SIGNATURE,\n\tFLV_NOT_EXPECTED_ADJACENT_DATA\n}\n\nexport default codes;\n","/**\n * @file: dv.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Bit buffer reader like DataView.\n */\n\nfunction read(buf: ArrayBuffer | Uint8Array): DataView {\n\tlet byteOffset = 0;\n\n\tif (ArrayBuffer.isView(buf)) {\n\t\tbyteOffset = buf.byteOffset;\n\t\tbuf = buf.buffer;\n\t}\n\n\treturn new DataView(buf, byteOffset);\n}\n\nclass DataViewReader {\n\tconstructor() {}\n\n\t/**\n\t * Gets an unsigned 8-bit integer (unsigned byte).\n\t * @param buffer\n\t * @param byteOffset    The offset, in byte, from the start of the view where to read the data.\n\t * @returns {number}    An unsigned 8-bit integer number.\n\t */\n\treadUint8(buffer: ArrayBuffer | Uint8Array, byteOffset: number): number {\n\t\treturn read(buffer).getUint8(byteOffset);\n\t}\n\n\t/**\n\t * Gets an unsigned 16-bit integer (unsigned long).\n\t * @param buffer\n\t * @param byteOffset     The offset, in byte, from the start of the view where to read the data.\n\t * @param littleEndian   Indicates whether the 16-bit int is stored in little- or big-endian format.\n\t * @returns {number}     An unsigned 16-bit integer number.\n\t */\n\treadUint16(buffer: ArrayBuffer | Uint8Array, byteOffset, littleEndian: boolean = false): number {\n\t\treturn read(buffer).getUint16(byteOffset, littleEndian);\n\t}\n\n\t/**\n\t * Gets an unsigned 32-bit integer (unsigned long).\n\t * @param buffer\n\t * @param byteOffset        The offset, in byte, from the start of the view where to read the data.\n\t * @param littleEndian      Indicates whether the 32-bit int is stored in little- or big-endian format.\n\t * @returns {number}        An unsigned 32-bit integer number.\n\t */\n\treadUint32(buffer: ArrayBuffer | Uint8Array, byteOffset: number, littleEndian: boolean = false): number {\n\t\treturn read(buffer).getUint32(byteOffset, littleEndian);\n\t}\n}\n\nexport default DataViewReader;\n","/**\n * @file: patSection.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Structure for pat.\n */\nimport DataViewReader from '../../util/dv';\nimport logger from '../../util/logger';\n\n/**\n * @extends DataViewReader\n */\nclass PATSection extends DataViewReader {\n\tpublic table_id: number;\n\tpublic section_syntax_indicator: number;\n\tpublic section_length: number;\n\tpublic transport_stream_id: number;\n\tpublic version_number: number;\n\tpublic current_next_indicator: number;\n\tpublic section_number: number;\n\tpublic last_section_number: number;\n\tpublic network_PID: number;\n\tpublic pmtTable: Array<M2TS.PMTTableItem>;\n\tpublic CRC_32: number;\n\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\t// program_association_section 0x00\n\t\tthis.table_id = buffer[0];\n\n\t\tthis.section_syntax_indicator = buffer[1] >> 7;\n\n\t\t// this.zero = (buffer[1] >> 6) & 0x1;\n\n\t\t// this.reserved_0 = (buffer[1] >> 4) & 0x3;\n\n\t\t// the number of bytes of the section\n\t\t// starting immediately following the section_length field, and including the CRC.\n\t\tthis.section_length = ((buffer[1] & 0x0f) << 8) | buffer[2];\n\n\t\tthis.transport_stream_id = this.readUint16(buffer, 3);\n\n\t\t// this.reserved_1 = buffer[5] >> 6;\n\n\t\tthis.version_number = (buffer[5] >> 1) & 0x1f;\n\n\t\tthis.current_next_indicator = buffer[5] && 0x01;\n\n\t\t// The section_number of the first section in the Program Association Table shall be 0x00.\n\t\t// It shall be incremented by 1 with each additional section in the PAT.\n\t\tthis.section_number = buffer[6];\n\n\t\t// The number of the last section (that is, the section with the highest section_number) of the complete PAT.\n\t\tthis.last_section_number = buffer[7];\n\n\t\tthis.network_PID = 0x00;\n\t\tvar n = 0,\n\t\t\tprogram_num,\n\t\t\treserved_3;\n\t\tvar len = this.section_length - 4 - 5; // 4: crc32, 5: bytes followed by section_length\n\n\t\tthis.pmtTable = [];\n\t\t/* loop by 4 bytes, during  */\n\t\tfor (; n < len; n += 4) {\n\t\t\tprogram_num = this.readUint16(buffer, 8 + n);\n\t\t\treserved_3 = buffer[10 + n] >> 5;\n\n\t\t\tif (program_num == 0x00) {\n\t\t\t\tthis.network_PID = ((buffer[10 + n] & 0x1f) << 8) | buffer[11 + n];\n\n\t\t\t\t// 记录该TS流的网络PID\n\t\t\t\t// TS_network_Pid = this.network_PID;\n\n\t\t\t\tlogger.log('packet->network_PID %0x /n/n', this.network_PID);\n\t\t\t} else {\n\t\t\t\tthis.pmtTable.push({\n\t\t\t\t\tprogramNum: program_num,\n\t\t\t\t\tprogram_map_PID: ((buffer[10 + n] & 0x1f) << 8) | buffer[11 + n]\n\t\t\t\t});\n\n\t\t\t\t// TS_PAT_Program\n\t\t\t\t// PAT_program;\n\t\t\t\t// PAT_program.program_map_PID = (buffer[10 + n] & 0x1F) << 8 | buffer[11 + n];\n\t\t\t\t// PAT_program.program_number = program_num;\n\t\t\t\t// this.program.push_back(PAT_program);\n\t\t\t\t// TS_program.push_back(PAT_program);//向全局PAT节目数组中添加PAT节目信息\n\t\t\t}\n\t\t}\n\n\t\tvar crcLength = this.section_length + 3;\n\t\tthis.CRC_32 =\n\t\t\t((buffer[crcLength - 4] & 0x000000ff) << 24) |\n\t\t\t((buffer[crcLength - 3] & 0x000000ff) << 16) |\n\t\t\t((buffer[crcLength - 2] & 0x000000ff) << 8) |\n\t\t\t(buffer[crcLength - 1] & 0x000000ff);\n\t}\n}\n\nexport default PATSection;\n","/**\n * @file: pmtSection.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Structure for pat.\n */\nimport DataViewReader from '../../util/dv';\nimport logger from '../../util/logger';\n\n/**\n * @extends DataViewReader\n */\nclass PMTSection extends DataViewReader {\n\ttable_id: number;\n\tsection_syntax_indicator: number;\n\tsection_length: number;\n\tprogram_number: number;\n\tversion_number: number;\n\tcurrent_next_indicator: number;\n\tsection_number: number;\n\tlast_section_number: number;\n\tPCR_PID: number;\n\tprogram_info_length: number;\n\tpes_table: Array<M2TS.PESTableItem>;\n\tCRC_32: number;\n\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\t// program_map_section  0x02\n\t\tthis.table_id = buffer[0];\n\n\t\tthis.section_syntax_indicator = buffer[1] >> 7;\n\n\t\t// this.zero = (buffer[1] >> 6) & 0x1;\n\n\t\t// this.reserved_0 = (buffer[1] >> 4) & 0x3;\n\n\t\t// the number of bytes of the section\n\t\t// starting immediately following the section_length field, and including the CRC.\n\t\tthis.section_length = ((buffer[1] & 0x0f) << 8) | buffer[2];\n\n\t\t// It specifies the program to which the program_map_PID is applicable.\n\t\tthis.program_number = this.readUint16(buffer, 3);\n\n\t\t// this.reserved_1 = buffer[5] >> 6;\n\n\t\tthis.version_number = (buffer[5] >> 1) & 0x1f;\n\n\t\tthis.current_next_indicator = buffer[5] && 0x01;\n\n\t\t// The section_number of the first section in the Program Association Table shall be 0x00.\n\t\t// It shall be incremented by 1 with each additional section in the PAT.\n\t\tthis.section_number = buffer[6];\n\n\t\t// The number of the last section (that is, the section with the highest section_number) of the complete PAT.\n\t\tthis.last_section_number = buffer[7];\n\n\t\t// contain the PCR fields valid for the program specified by program_number.\n\t\tthis.PCR_PID = ((buffer[8] & 0x1f) << 8) | buffer[9];\n\n\t\t// this.reserved_2 = buffer[10] >> 4;\n\n\t\t// The number of bytes of the descriptors immediately following the program_info_length field.\n\t\tthis.program_info_length = ((buffer[10] & 0x0f) << 8) | buffer[11];\n\n\t\tif (this.program_info_length < 0) {\n\t\t\treturn;\n\t\t} else if (this.program_info_length > 2) {\n\t\t\tlet i = 0;\n\n\t\t\twhile (i < this.program_info_length) {\n\t\t\t\t// let descriptor_tag = buffer[12 + i];\n\t\t\t\tlet descriptor_length = buffer[13 + i];\n\n\t\t\t\t// \tlogger.log('descriptor_tag', descriptor_tag, descriptor_length);\n\t\t\t\ti += descriptor_length;\n\t\t\t}\n\t\t}\n\n\t\tvar es_section_pos = 12 + this.program_info_length;\n\t\tvar es_section_len = this.section_length - this.program_info_length - 9 - 4; // 9: bytes followed by section_length, 4: crc32\n\t\tvar es_section_end = es_section_pos + es_section_len;\n\n\t\tif (es_section_pos >= es_section_end) {\n\t\t\tlogger.warn(`es_section_pos < es_section_end ${es_section_pos}, ${es_section_end}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.pes_table = [];\n\n\t\tlet j = 0;\n\t\twhile (j < es_section_len) {\n\t\t\tlet stream_type = buffer[es_section_pos + j];\n\t\t\tlet elementary_PID = this.readUint16(buffer, es_section_pos + j + 1) & 0x1fff;\n\t\t\tlet ES_info_length = this.readUint16(buffer, es_section_pos + j + 3) & 0x0fff;\n\n\t\t\tthis.pes_table.push({\n\t\t\t\tstreamType: stream_type,\n\t\t\t\tPID: elementary_PID\n\t\t\t});\n\n\t\t\tif (ES_info_length > 2) {\n\t\t\t\tlet k = 0;\n\t\t\t\tlet es_pos = es_section_pos + j + 5;\n\n\t\t\t\twhile (k < ES_info_length) {\n\t\t\t\t\t// let descriptor_tag = buffer[es_pos + k];\n\t\t\t\t\tlet descriptor_length = buffer[es_pos + k];\n\n\t\t\t\t\t// if (descriptor_tag === )\n\t\t\t\t\tk += descriptor_length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tj += ES_info_length + 5;\n\t\t}\n\n\t\tvar crcLength = this.section_length + 3;\n\t\tthis.CRC_32 =\n\t\t\t((buffer[crcLength - 4] & 0x000000ff) << 24) |\n\t\t\t((buffer[crcLength - 3] & 0x000000ff) << 16) |\n\t\t\t((buffer[crcLength - 2] & 0x000000ff) << 8) |\n\t\t\t(buffer[crcLength - 1] & 0x000000ff);\n\t}\n\n\tparse() {\n\t\t// let data = this.uint8;\n\t}\n}\n\nexport default PMTSection;\n","/**\n * @file: sdtSection.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Structure for sdt.\n */\nimport DataViewReader from '../../util/dv';\nimport logger from '../../util/logger';\n\nclass SDTSection extends DataViewReader {\n\ttable_id: number;\n\tsection_syntax_indicator: number;\n\tsection_length: number;\n\ttransport_stream_id: number;\n\tversion_number: number;\n\tcurrent_next_indicator: number;\n\tsection_number: number;\n\tlast_section_number: number;\n\toriginal_network_id: number;\n\tservice_table: Array<M2TS.SDTServiceItem>;\n\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\t// program_map_section  0x02\n\t\tthis.table_id = buffer[0];\n\n\t\tthis.section_syntax_indicator = buffer[1] >> 7;\n\n\t\t// this.reserved_0 = (buffer[1] >> 4) & 0x3;\n\n\t\t// the number of bytes of the section\n\t\t// starting immediately following the section_length field, and including the CRC.\n\t\tthis.section_length = ((buffer[1] & 0x0f) << 8) | buffer[2];\n\n\t\t// This is a 16-bit field which serves as a label for identification of the TS,\n\t\t// about which the SDT informs, from any other multiplex within the delivery system\n\t\tthis.transport_stream_id = this.readUint16(buffer, 3);\n\n\t\t// this.reserved_1 = buffer[5] >> 6;\n\n\t\tthis.version_number = (buffer[5] >> 1) & 0x1f;\n\n\t\tthis.current_next_indicator = buffer[5] & 0x01;\n\n\t\t// The section_number of the first section in the sub_table shall be \"0x00\".\n\t\t// The section_number shall be incremented by 1 with each additional section\n\t\t// with the same table_id, transport_stream_id, and original_network_id.\n\t\tthis.section_number = buffer[6];\n\n\t\t// This 8-bit field specifies the number of the last section\n\t\t// (that is, the section with the highest section_number) of the sub_table of which this section is part\n\t\tthis.last_section_number = buffer[7];\n\n\t\t// This field gives the label identifying the network_id of the originating delivery system.\n\t\tthis.original_network_id = this.readUint16(buffer, 8);\n\n\t\t// this.reserved_2 = buffer[10];\n\n\t\t// section_length - (following the section_length field length) - crc32Length\n\t\tlet sv_len = this.section_length - 8 - 4; // 8: bytes followed by section_length, 4: crc32\n\n\t\tthis.service_table = [];\n\t\tlet i = 0;\n\n\t\twhile (i < sv_len) {\n\t\t\tlet j = 0;\n\t\t\tlet service: M2TS.SDTServiceItem = {\n\t\t\t\tservice_id: this.readUint16(buffer, 11),\n\t\t\t\tEIT_schedule_flag: buffer[13] & 0x02,\n\t\t\t\tEIT_present_following_flag: buffer[13] & 0x01,\n\t\t\t\trunning_status: buffer[14] >> 5,\n\t\t\t\tfree_CA_mode: (buffer[14] >> 4) & 0x01,\n\t\t\t\tdescriptors_loop_length: ((buffer[14] & 0x0f) << 8) | buffer[15],\n\t\t\t\tprovider_name: '',\n\t\t\t\tname: ''\n\t\t\t};\n\n\t\t\twhile (j < service.descriptors_loop_length) {\n\t\t\t\tlet start = 16 + j;\n\t\t\t\tlet descriptor_tag = buffer[start];\n\t\t\t\tlet descriptor_length = buffer[start + 1];\n\n\t\t\t\tswitch (descriptor_tag) {\n\t\t\t\t\tcase 0x48: // service_descriptor\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// let service_type = buffer[start + 2];\n\t\t\t\t\t\t\tlet service_provider_name = [];\n\t\t\t\t\t\t\tlet service_provider_name_length = buffer[start + 3];\n\t\t\t\t\t\t\tlet k = 0,\n\t\t\t\t\t\t\t\tl = 0,\n\t\t\t\t\t\t\t\tnextPos = start + 4;\n\n\t\t\t\t\t\t\tfor (k = 0; k < service_provider_name_length; k++) {\n\t\t\t\t\t\t\t\tservice_provider_name.push(String.fromCharCode(buffer[nextPos]));\n\t\t\t\t\t\t\t\tnextPos += 1;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tservice.provider_name = service_provider_name.join('');\n\n\t\t\t\t\t\t\tlet service_name = [];\n\t\t\t\t\t\t\tlet service_name_length = buffer[nextPos];\n\t\t\t\t\t\t\tnextPos += 1;\n\n\t\t\t\t\t\t\tfor (l = 0; l < service_name_length; l++) {\n\t\t\t\t\t\t\t\tservice_name.push(String.fromCharCode(buffer[nextPos]));\n\t\t\t\t\t\t\t\tnextPos += 1;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tservice.name = service_name.join('');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tlogger.warn(`sdt section unhandled descriptor_tag ${descriptor_tag}`);\n\t\t\t\t}\n\n\t\t\t\tj += 2 + descriptor_length;\n\t\t\t}\n\n\t\t\tthis.service_table.push(service);\n\n\t\t\ti += 5 + service.descriptors_loop_length;\n\t\t}\n\t}\n}\n\nexport default SDTSection;\n","/**\n * @file: m2t-pid.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * @overview Program and program element descriptors.\n * @see ISO/IEC 13818-1: Table 2-3 – PID table\n * @see DVB SI: 5.1.3 Coding of PID and table_id fields\n */\n\n/**\n * @readonly\n * @enum {number}\n * @export\n */\nexport const PAT_PID = 0x0000;\nexport const CAT_PID = 0x0001;\nexport const TSDT_PID = 0x0002;\n/* reserved 0x0003 to 0x000F */\nexport const SDT_PID = 0x0011;\n","/**\n * @file: psi.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * PSI(Program Specific Information)\n */\n\nimport PATSection from './structs/patSection';\nimport PMTSection from './structs/pmtSection';\nimport SDTSection from './structs/sdtSection';\nimport { PAT_PID, CAT_PID, TSDT_PID, SDT_PID } from '../enum/m2t-pid';\nimport { Context } from '../types/globals';\nimport Packet from './structs/packet';\nimport StreamTypes from '../enum/stream-types';\n\n// const MAX_PIDS_PER_PROGRAM = 64;\n\nexport interface Track {\n\tid: number;\n\tduration: number;\n\twidth?: number;\n\theight?: number;\n\tcodec: string;\n\trealCodec?: string;\n\tprofileIdc?: number;\n\tprofileCompatibility?: number;\n\tlevelIdc?: number;\n\tpixelRatio?: [number, number];\n\ttimescale: number; // (in TS timescale = 90kHz)\n\tinputTimeScale?: number;\n\tsps: Array<Uint8Array>;\n\tpps: Array<Uint8Array>;\n\tstream_type: StreamTypes;\n\tpcr_pid: number;\n\n\t// Audio\n\tisAAC?: boolean;\n\tsampleRate?: number;\n\tchannelCount?: number;\n\tconfig?: any;\n}\n\nclass Metadata {\n\tservice_name: string;\n\tservice_provider: string;\n}\n\nclass PSI {\n\t/**\n\t * program PID\n\t */\n\tget currentProgramPID(): number {\n\t\tlet _pmtIds = [];\n\n\t\tfor (let i = 0; i < this.pat_table.length; i++) {\n\t\t\t_pmtIds.push(this.pat_table[i].pid);\n\t\t}\n\n\t\treturn _pmtIds.length > 0 ? _pmtIds[0] : -1;\n\t}\n\n\t// get pmtTable() {\n\t//     return this.pat_table;\n\t// }\n\n\tprivate context: Context;\n\tprivate metadata: Metadata; // Specify by SDT Packet\n\tprivate pat_table: Array<M2TS.PATTableItem>; // Specify by PMT Packet\n\tprivate pes_streams: Array<M2TS.PSI_PES_Stream>; // Specify by PES stream\n\n\tconstructor(ctx: Context) {\n\t\tthis.context = ctx;\n\t\tthis.metadata = new Metadata();\n\t\tthis.pat_table = [];\n\t\tthis.pes_streams = [];\n\t}\n\n\t/**\n\t * 目前对于PSI的信息，持久化保留在内存中\n\t * 对于同一个片子，HLS规范会规定只能有一个 PMT/PAT 表\n\t * 所以一部片子的PSI信息应该是保持不变的，换片子后PSI信息的销毁通过 mux 重新实例化产生新的信息，不需要调用reset\n\t * 有些 TS 文件在HLS切片器切割的时候，没有带上PAT/PMT等表，需要相邻 TS 给定的表信息\n\t */\n\treset(): void {\n\t\tthis.metadata = new Metadata();\n\t\tthis.pat_table.splice(0, this.pat_table.length);\n\t\tthis.pes_streams.splice(0, this.pes_streams.length);\n\t}\n\n\t/**\n\t * @param packet\n\t */\n\tparse(packet: Packet): void {\n\t\tconst self = this;\n\n\t\t// ISO13818-1: Table 2-3 – PID table\n\t\tif (PAT_PID === packet.PID) {\n\t\t\t/* PAT PID */\n\t\t\tthis._parsePat(packet);\n\t\t} else if (CAT_PID === packet.PID) {\n\t\t\t/* CAT PID */\n\t\t} else if (TSDT_PID === packet.PID) {\n\t\t\t/* Transport Stream Description Table */\n\t\t} else if (0x0003 <= packet.PID && packet.PID <= 0x000f) {\n\t\t\t/* Reserved */\n\t\t} else if (SDT_PID === packet.PID) {\n\t\t\t/* Service Description Table */\n\t\t\tthis._parseSdt(packet);\n\t\t} else if (packet.PID === self.currentProgramPID) {\n\t\t\t/* PMT PID */\n\t\t\tthis._parsePmt(packet);\n\t\t}\n\t\t// else if (this.findTrack(packet.PID)) {\n\t\t// \t/* Reserved */\n\t\t// } else {\n\t\t// \tlogger.warn(`psi unknown packet PID ${packet.PID}`);\n\t\t// }\n\t}\n\n\t// findPmtProgram(PID) {\n\t// \tlet program = null;\n\t//\n\t// \tfor (let i = 0; i < this.pat_table.length; i++) {\n\t// \t\tif (this.pat_table[i].pid === PID) {\n\t// \t\t\tprogram = this.pat_table[i].id;\n\t// \t\t\tbreak;\n\t// \t\t}\n\t// \t}\n\t//\n\t// \treturn program;\n\t// }\n\n\t/**\n\t * @param PID\n\t */\n\tfindTrack(PID: number): Track {\n\t\tlet program = null;\n\t\tlet streams = this.pes_streams;\n\n\t\tfor (let i = 0; i < streams.length; i++) {\n\t\t\tif (streams[i].id === PID) {\n\t\t\t\tprogram = streams[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn program;\n\t}\n\n\t/**\n\t * Parse PAT Packet\n\t * @param pack\n\t * @private\n\t */\n\tprivate _parsePat(pack: Packet): PATSection {\n\t\tlet data: Uint8Array;\n\n\t\tif (pack.payload_unit_start_indicator) {\n\t\t\t// psi has pointer_field\n\t\t\tlet pointer = pack.payload[0];\n\n\t\t\tdata = pack.payload.subarray(pointer + 1);\n\t\t} else {\n\t\t\tdata = pack.payload;\n\t\t}\n\n\t\tlet pat = new PATSection(data);\n\n\t\t// https://tools.ietf.org/html/rfc8216#section-3.2\n\t\t// Transport Stream Segments MUST contain a single MPEG-2 Program;\n\t\tfor (var i = 0; i < pat.pmtTable.length; i++) {\n\t\t\tthis._add_pid_to_pmt(pat.pmtTable[i].programNum, pat.pmtTable[i].program_map_PID);\n\t\t}\n\n\t\treturn pat;\n\t}\n\n\t/**\n\t * Associates Program Number and Program Map Table(PMT) PID\n\t * @param programId\n\t * @param pid\n\t */\n\tprivate _add_pid_to_pmt(programId: number, pid: number): void {\n\t\tlet table = this.pat_table;\n\n\t\tfunction get_pmt(id: number) {\n\t\t\tfor (let i = 0, item: M2TS.PATTableItem; i < table.length; i++) {\n\t\t\t\titem = table[i];\n\t\t\t\tif (item.id === id) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidx: i,\n\t\t\t\t\t\titem\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tlet p = get_pmt(programId);\n\t\tif (!p) {\n\t\t\ttable.push({\n\t\t\t\tid: programId,\n\t\t\t\tpid: pid\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Parse PMT Packet\n\t * @param pack\n\t */\n\tprivate _parsePmt(pack: Packet): PMTSection {\n\t\tlet data: Uint8Array;\n\n\t\tif (pack.payload_unit_start_indicator) {\n\t\t\t// psi has pointer_field\n\t\t\tlet pointer = pack.payload[0];\n\n\t\t\tdata = pack.payload.subarray(pointer + 1);\n\t\t} else {\n\t\t\tdata = pack.payload;\n\t\t}\n\n\t\tlet pmt = new PMTSection(data);\n\n\t\tfor (var i = 0; i < pmt.pes_table.length; i++) {\n\t\t\tthis._add_pes_stream(pmt.pes_table[i], pmt);\n\t\t}\n\n\t\treturn pmt;\n\t}\n\n\t/**\n\t * @param stream\n\t * @param pmt\n\t */\n\tprivate _add_pes_stream(stream: M2TS.PESTableItem, pmt: PMTSection): void {\n\t\tlet streams = this.pes_streams;\n\n\t\tfunction get_program(id: number) {\n\t\t\tfor (let i = 0, item: M2TS.PSI_PES_Stream; i < streams.length; i++) {\n\t\t\t\titem = streams[i];\n\t\t\t\tif (item.id === id) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidx: i,\n\t\t\t\t\t\titem\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tlet p = get_program(stream.PID);\n\t\tif (!p) {\n\t\t\tstreams.push({\n\t\t\t\tid: stream.PID,\n\t\t\t\tstream_type: stream.streamType,\n\t\t\t\tpcr_pid: pmt.PCR_PID,\n\t\t\t\tduration: 0,\n\t\t\t\tsps: [],\n\t\t\t\tpps: [],\n\t\t\t\tpixelRatio: [1, 1],\n\t\t\t\ttimescale: 90000, // (in TS timescale = 90kHz)\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Parse SDT Packet\n\t * @param pack\n\t */\n\tprivate _parseSdt(pack: Packet): SDTSection {\n\t\tlet data: Uint8Array;\n\n\t\tif (pack.payload_unit_start_indicator) {\n\t\t\t// psi has pointer_field\n\t\t\tlet pointer = pack.payload[0];\n\n\t\t\tdata = pack.payload.subarray(pointer + 1);\n\t\t} else {\n\t\t\tdata = pack.payload;\n\t\t}\n\n\t\tlet sdt = new SDTSection(data);\n\n\t\tif (sdt.service_table.length > 0) {\n\t\t\tthis.metadata.service_name = sdt.service_table[0].name;\n\t\t\tthis.metadata.service_provider = sdt.service_table[0].provider_name;\n\t\t}\n\n\t\treturn sdt;\n\t}\n}\n\nexport default PSI;\n","/**\n * @file: complex.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Complex Stream.\n *\n * Combine Video, Audio, Caption c and other data.\n */\nimport Stream from '../../util/stream';\nimport logger from '../../util/logger';\n\nclass M2TSComplexStream extends Stream {\n\tconstructor(ctx, psi) {\n\t\tsuper();\n\n\t\t/** @private */\n\t\tthis.context = ctx;\n\n\t\t/** @private {PSI} */\n\t\tthis.PSI = psi;\n\n\t\t/** @private {Object} */\n\t\tthis.videoTrack = null;\n\n\t\t/** @private {Object} */\n\t\tthis.audioTrack = null;\n\n\t\t/** @private {Object} */\n\t\tthis.captionTrack = null;\n\n\t\t// pipe specified by outside.\n\t}\n\n\tpush(data) {\n\t\tlet tracks = data;\n\n\t\tfor (let i = 0, track; i < tracks.length; i++) {\n\t\t\ttrack = tracks[i];\n\n\t\t\tswitch (track.type) {\n\t\t\t\tcase 'video':\n\t\t\t\t\t// data -> GOPs\n\t\t\t\t\tthis._complexVideo(track);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'audio':\n\t\t\t\t\tthis._complexAudio(track);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'caption':\n\t\t\t\t\tthis._complexCaption(track);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tflush() {\n\t\tthis.emit('done');\n\n\t\tthis._clearStream();\n\t}\n\n\treset() {\n\t\tthis._clearStream();\n\n\t\t// This is demux end stream, so don't emit reset.\n\t\t// this.emit('reset');\n\t}\n\n\t_clearStream() {\n\t\tthis.videoTrack = null;\n\t\tthis.audioTrack = null;\n\t\tthis.captionTrack = null;\n\t}\n\n\t_complexVideo(gops) {\n\t\tlet track = this.PSI.findTrack(gops.trackId);\n\n\t\tif (track) {\n\t\t\ttrack.type = 'video';\n\t\t\ttrack.gops = gops;\n\t\t\ttrack.firstDTS = gops[0][0].dts;\n\t\t\ttrack.firstPTS = gops[0][0].pts;\n\t\t\t// set duration to Infinity(POSITIVE_INFINITY) can be useful for live.\n\t\t\t// If Infinity it will loose the ability to seek.\n\t\t\ttrack.duration = Number.POSITIVE_INFINITY;\n\n\t\t\tthis.videoTrack = track;\n\n\t\t\tthis.emit('data', {\n\t\t\t\tvideoTrack: this.videoTrack\n\t\t\t});\n\t\t}\n\t}\n\n\t_complexAudio(frames) {\n\t\tlet track = this.PSI.findTrack(frames.trackId);\n\n\t\tif (track) {\n\t\t\ttrack.type = 'audio';\n\t\t\ttrack.frames = frames;\n\t\t\ttrack.firstPTS = track.firstDTS = frames[0].dts;\n\n\t\t\t// set duration to Infinity(POSITIVE_INFINITY) can be useful for live.\n\t\t\t// If Infinity it will loose the ability to seek.\n\t\t\ttrack.duration = Number.POSITIVE_INFINITY;\n\n\t\t\tthis.audioTrack = track;\n\n\t\t\tthis.emit('data', {\n\t\t\t\taudioTrack: this.audioTrack\n\t\t\t});\n\t\t}\n\t}\n\n\t_complexCaption() {}\n}\n\nexport default M2TSComplexStream;\n","/**\n * @file: platform.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * @description device\n */\nconst os = {\n\tmac: false,\n\tiphone: false,\n\tandroid: false\n};\nconst browser = {\n\tversion: false,\n\tCHROME: false,\n\tSAFARI: false,\n\tFIREFOX: false,\n\tIE11: false,\n\tIE: false,\n\tEDGE: false,\n\tWECHAT: false\n};\n\nlet nav = navigator;\n// let platform = nav.platform;\nlet ua = nav.userAgent.toLowerCase();\n\nvar match =\n\t/(edge)\\/([\\w.]+)/.exec(ua) ||\n\t/(opr)[/]([\\w.]+)/.exec(ua) ||\n\t/(chrome)[ /]([\\w.]+)/.exec(ua) ||\n\t/(firefox)[ /]([\\w.]+)/.exec(ua) ||\n\t/(iemobile)[/]([\\w.]+)/.exec(ua) ||\n\t/(version)(applewebkit)[ /]([\\w.]+).*(safari)[ /]([\\w.]+)/.exec(ua) ||\n\t/(webkit)[ /]([\\w.]+).*(version)[ /]([\\w.]+).*(safari)[ /]([\\w.]+)/.exec(ua) ||\n\t/(webkit)[ /]([\\w.]+)/.exec(ua) ||\n\t/(opera)(?:.*version|)[ /]([\\w.]+)/.exec(ua) ||\n\t/(msie) ([\\w.]+)/.exec(ua) ||\n\t(ua.indexOf('trident') >= 0 && /(rv)(?::| )([\\w.]+)/.exec(ua)) ||\n\t(ua.indexOf('compatible') < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua)) ||\n\t[];\n\nvar platform_match =\n\t/(ipad)/.exec(ua) ||\n\t/(ipod)/.exec(ua) ||\n\t/(windows phone)/.exec(ua) ||\n\t/(iphone)/.exec(ua) ||\n\t/(kindle)/.exec(ua) ||\n\t/(silk)/.exec(ua) ||\n\t/(android)/.exec(ua) ||\n\t/(win)/.exec(ua) ||\n\t/(mac)/.exec(ua) ||\n\t/(linux)/.exec(ua) ||\n\t/(cros)/.exec(ua) ||\n\t/(playbook)/.exec(ua) ||\n\t/(bb)/.exec(ua) ||\n\t/(blackberry)/.exec(ua) ||\n\t[];\n\nvar result = {\n\tversion: undefined\n};\nvar matched = {\n\tbrowser: match[5] || match[3] || match[1] || '',\n\tversion: match[2] || match[4] || '0',\n\tversionNumber: match[4] || match[2] || '0',\n\tplatform: platform_match[0] || ''\n};\n\nif (matched.browser) {\n\tresult[matched.browser] = true;\n\t// result.version = matched.version;\n\t// result.versionNumber = parseInt(matched.versionNumber, 10);\n\n\tlet versionArray = matched.versionNumber.split('.');\n\tresult.version = {\n\t\tmajor: parseInt(matched.versionNumber, 10),\n\t\tstring: matched.version\n\t};\n\tif (versionArray.length > 1) {\n\t\tresult.version.minor = parseInt(versionArray[1], 10);\n\t}\n\tif (versionArray.length > 2) {\n\t\tresult.version.build = parseInt(versionArray[2], 10);\n\t}\n}\n\n// -------------------------------------- browser --------------------------------------\nbrowser.version = result.version;\nbrowser.CHROME = !!result['chrome'];\nbrowser.SAFARI = !!result['safari'] && !browser.CHROME;\nbrowser.FIREFOX = !!result['firefox'];\nbrowser.IE11 = /rv:11/.test(ua);\nbrowser.IE = !!result['msie'] || browser.IE11;\nbrowser.EDGE = !!result['edge'];\nbrowser.WECHAT = /(wechat)|(micromessenger)/.test(ua);\n\n// -------------------------------------- os --------------------------------------\n\nos.mac = !!matched.platform['mac'];\nos.iphone = !!matched.platform['iphone'];\nos.android = !!matched.platform['android'];\n\nexport default {\n\tbrowser: browser,\n\tos: os\n};\n","/**\n * @file: aac-config.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Audio Config Helper\n * Accord audioObjectType/samplingFrequencyIndex/channelCount, generate mimeType info.\n */\nimport platform from '../../util/platform';\nimport logger from '../../util/logger';\n\n/*\n    sampling freq,\n    0: 96000 Hz\n    1: 88200 Hz\n    2: 64000 Hz\n    3: 48000 Hz\n    4: 44100 Hz\n    5: 32000 Hz\n    6: 24000 Hz\n    7: 22050 Hz\n    8: 16000 Hz\n    9: 12000 Hz\n    10: 11025 Hz\n    11: 8000 Hz\n    12: 7350 Hz\n    13: Reserved\n    14: Reserved\n    15: frequency is written explictly\n */\nconst samplingRates = [96000, 88200, 64000, 48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000, 7350];\n\nexport default (audioObjectType: number, samplingFrequencyIndex: number, channelCount: number) => {\n\tlet adtsExtensionSamplingIndex;\n\tlet realAudioObjectType = audioObjectType;\n\tlet config;\n\n\tif (samplingFrequencyIndex > samplingRates.length - 1) {\n\t\tlogger.error(`invalid sampling index:${samplingFrequencyIndex}`);\n\t\treturn;\n\t}\n\n\t// firefox: freq less than 24kHz = AAC SBR (HE-AAC)\n\tif (platform.browser.FIREFOX) {\n\t\tif (samplingFrequencyIndex >= 6) {\n\t\t\taudioObjectType = 5;\n\t\t\tconfig = new Array(4);\n\t\t\t// HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies\n\t\t\t// there is a factor 2 between frame sample rate and output sample rate\n\t\t\t// multiply frequency by 2 (see table below, equivalent to substract 3)\n\t\t\tadtsExtensionSamplingIndex = samplingFrequencyIndex - 3;\n\t\t} else {\n\t\t\taudioObjectType = 2;\n\t\t\tconfig = new Array(2);\n\t\t\tadtsExtensionSamplingIndex = samplingFrequencyIndex;\n\t\t}\n\t\t// Android : always use AAC\n\t} else if (platform.os.android) {\n\t\taudioObjectType = 2;\n\t\tconfig = new Array(2);\n\t\tadtsExtensionSamplingIndex = samplingFrequencyIndex;\n\t} else {\n\t\t/*  for other browsers (Chrome/Vivaldi/Opera ...)\n\t\t\t\talways force audio type to be HE-AAC SBR, as some browsers do not support audio codec switch properly (like Chrome ...)\n\t\t\t*/\n\t\taudioObjectType = 5;\n\t\tconfig = new Array(4);\n\t\t// if (manifest codec is HE-AAC or HE-AACv2) OR (manifest codec not specified AND frequency less than 24kHz)\n\t\tif (samplingFrequencyIndex >= 6) {\n\t\t\t// HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies\n\t\t\t// there is a factor 2 between frame sample rate and output sample rate\n\t\t\t// multiply frequency by 2 (see table below, equivalent to substract 3)\n\t\t\tadtsExtensionSamplingIndex = samplingFrequencyIndex - 3;\n\t\t} else {\n\t\t\t// if (manifest codec is AAC) AND (frequency less than 24kHz AND nb channel is 1) OR (manifest codec not specified and mono audio)\n\t\t\t// Chrome fails to play back with low frequency AAC LC mono when initialized with HE-AAC.  This is not a problem with stereo.\n\t\t\tif (channelCount === 1) {\n\t\t\t\taudioObjectType = 2;\n\t\t\t\tconfig = new Array(2);\n\t\t\t}\n\t\t\tadtsExtensionSamplingIndex = samplingFrequencyIndex;\n\t\t}\n\t}\n\t/* \n        refer to http://wiki.multimedia.cx/index.php?title=MPEG-4_Audio#Audio_Specific_Config ISO 14496-3 (AAC).pdf \n            - Table 1.13 — Syntax of AudioSpecificConfig()\n\t\t  Audio Profile / Audio Object Type\n\t\t  0: Null\n\t\t  1: AAC Main\n\t\t  2: AAC LC (Low Complexity)\n\t\t  3: AAC SSR (Scalable Sample Rate)\n\t\t  4: AAC LTP (Long Term Prediction)\n\t\t  5: SBR (Spectral Band Replication)\n\t\t  6: AAC Scalable\n\n\t\t  Channel Configurations\n\t\t  These are the channel configurations:\n\t\t  0: Defined in AOT Specifc Config\n\t\t  1: 1 channel: front-center\n\t\t  2: 2 channels: front-left, front-right\n\t\t*/\n\t// audioObjectType = profile => profile, the MPEG-4 Audio Object Type minus 1\n\tconfig[0] = audioObjectType << 3;\n\t// samplingFrequencyIndex\n\tconfig[0] |= (samplingFrequencyIndex & 0x0e) >> 1;\n\tconfig[1] |= (samplingFrequencyIndex & 0x01) << 7;\n\t// channelConfiguration\n\tconfig[1] |= channelCount << 3;\n\tif (audioObjectType === 5) {\n\t\t// adtsExtensionSamplingIndex\n\t\tconfig[1] |= (adtsExtensionSamplingIndex & 0x0e) >> 1;\n\t\tconfig[2] = (adtsExtensionSamplingIndex & 0x01) << 7;\n\t\t// audioObjectType (force to 2, chrome is checking that object type is less than 5 ???\n\t\t//    https://chromium.googlesource.com/chromium/src.git/+/master/media/formats/mp4/aac.cc\n\t\tconfig[2] |= 2 << 2;\n\t\tconfig[3] = 0;\n\t}\n\n\treturn {\n\t\tconfig: config,\n\t\tsampleRate: samplingRates[samplingFrequencyIndex],\n\t\tchannelCount: channelCount,\n\t\tcodec: 'mp4a.40.' + audioObjectType,\n\t\trealCodec: 'mp4a.40.' + realAudioObjectType\n\t};\n};\n","/**\n * @file: created at Saturday, 9th May 2020 11:13:19 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n// The AudioSpecificConfig is explained in ISO 14496-3.\nexport interface AudioSpecificConfig {\n\taudioObjectType: number;\n\tsampleCount: number;\n\tchannelConfiguration: number;\n\tsampleRate: number;\n\tsamplingFrequencyIndex: number;\n\t// assume ISO/IEC 14496-12 AudioSampleEntry default of 16\n}\n\nexport interface AACFrame extends Omit<AudioSpecificConfig, 'channelConfiguration'> {\n\tpts: number;\n\tdts: number;\n\tdata: Uint8Array;\n\tchannelCount: number; // equal to channelConfiguration\n\tsampleSize: number;\n}\n\nexport const AAC_SAMPLING_FREQUENCIES = [\n\t96000,\n\t88200,\n\t64000,\n\t48000,\n\t44100,\n\t32000,\n\t24000,\n\t22050,\n\t16000,\n\t12000,\n\t11025,\n\t8000,\n\t7350\n];\n","/**\n * @file: adts.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * ADTS codec\n * Wiki Refer: https://wiki.multimedia.cx/index.php?title=ADTS\n */\nimport EventEmitter from '../util/event-emitter';\nimport { AACFrame, AAC_SAMPLING_FREQUENCIES } from './aac/aac';\n\nexport type AACCodecData = {\n\tpts: number;\n\tdts: number;\n\tpayload: Uint8Array;\n};\n\n/**\n * @extends EventEmitter\n */\nclass ADTSCodec extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tpush(data: AACCodecData) {\n\t\tlet { pts, dts, payload } = data;\n\t\tlet data_byte = payload;\n\t\tlet i = 0,\n\t\t\tframeNum = 0,\n\t\t\tframeLength,\n\t\t\tprotectionSkipBytes,\n\t\t\tframeEnd,\n\t\t\tsampleCount,\n\t\t\tadtsFrameDuration;\n\n\t\twhile (i + 5 < data_byte.length) {\n\t\t\t// Look for the start of an ADTS header..\n\t\t\tif (data_byte[i] !== 0xff || (data_byte[i + 1] & 0xf6) !== 0xf0) {\n\t\t\t\t// If a valid header was not found,  jump one forward and attempt to\n\t\t\t\t// find a valid ADTS header starting at the next byte\n\t\t\t\ti++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// The protection skip bit tells us if we have 2 bytes of CRC data at the\n\t\t\t// end of the ADTS header\n\t\t\tprotectionSkipBytes = (~data_byte[i + 1] & 0x01) * 2;\n\n\t\t\t// Frame length is a 13 bit integer starting 16 bits from the\n\t\t\t// end of the sync sequence\n\t\t\tframeLength =\n\t\t\t\t((data_byte[i + 3] & 0x03) << 11) | (data_byte[i + 4] << 3) | ((data_byte[i + 5] & 0xe0) >> 5);\n\n\t\t\tsampleCount = ((data_byte[i + 6] & 0x03) + 1) * 1024;\n\t\t\tadtsFrameDuration = (sampleCount * 90000) / AAC_SAMPLING_FREQUENCIES[(data_byte[i + 2] & 0x3c) >>> 2];\n\n\t\t\tframeEnd = i + frameLength;\n\n\t\t\t// If we don't have enough data to actually finish this ADTS frame, return\n\t\t\t// and wait for more data\n\t\t\tif (data_byte.byteLength < frameEnd) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet aacFrame: AACFrame = {\n\t\t\t\tpts: pts + frameNum * adtsFrameDuration,\n\t\t\t\tdts: dts + frameNum * adtsFrameDuration,\n\t\t\t\tsampleCount: sampleCount,\n\t\t\t\taudioObjectType: ((data_byte[i + 2] >>> 6) & 0x03) + 1,\n\t\t\t\tchannelCount: ((data_byte[i + 2] & 1) << 2) | ((data_byte[i + 3] & 0xc0) >>> 6),\n\t\t\t\tsampleRate: AAC_SAMPLING_FREQUENCIES[(data_byte[i + 2] & 0x3c) >>> 2],\n\t\t\t\tsamplingFrequencyIndex: (data_byte[i + 2] & 0x3c) >>> 2,\n\t\t\t\t// assume ISO/IEC 14496-12 AudioSampleEntry default of 16\n\t\t\t\tsampleSize: 16,\n\t\t\t\tdata: data_byte.subarray(i + 7 + protectionSkipBytes, frameEnd)\n\t\t\t};\n\t\t\t// Otherwise, deliver the complete AAC frame\n\t\t\tthis.emit('frame', aacFrame);\n\n\t\t\t// If the data_byte is empty, clear it and return\n\t\t\tif (data_byte.byteLength === frameEnd) {\n\t\t\t\tdata_byte = undefined;\n\n\t\t\t\tthis.emit('done');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tframeNum++;\n\n\t\t\t// Remove the finished frame from the data_byte and start the process again\n\t\t\tdata_byte = data_byte.subarray(frameEnd);\n\t\t}\n\t}\n}\n\nexport default ADTSCodec;\n","/**\n * @file: adts.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * ADTS(Audio Data Transport Stream) Stream.\n */\nimport { AACFrame } from '../../codec/aac/aac';\nimport getAudioConfig from '../../codec/aac/aac-config';\nimport ADTSCodec from '../../codec/adts';\nimport StreamType from '../../enum/stream-types';\nimport Stream from '../../util/stream';\nimport PSI from '../psi';\nimport { AACFrameList, PESStreamEmitData } from '../types/pipeline';\n\nclass ADTSStream extends Stream {\n\tprivate PSI: PSI;\n\tprivate trackId?: number;\n\tprivate codec: ADTSCodec;\n\tprivate frames: AACFrameList;\n\n\tconstructor(psi: PSI) {\n\t\tsuper();\n\n\t\tthis.PSI = psi;\n\t\tthis.trackId = null;\n\n\t\t/** @private {ADTSCodec} */\n\t\tthis.codec = new ADTSCodec();\n\n\t\tthis.codec.on('frame', (frame: AACFrame) => {\n\t\t\tthis.frames.push(frame);\n\t\t\tthis.frames.byteLength += frame.data.byteLength;\n\t\t\tthis.frames.trackId = this.trackId;\n\t\t});\n\n\t\tthis._newFrames();\n\t}\n\n\tpush(data: PESStreamEmitData) {\n\t\tif (data.stream_type === StreamType.ADTS) {\n\t\t\tthis.trackId = data.pid;\n\n\t\t\tthis.codec.push({\n\t\t\t\tdts: data.pes.DTS,\n\t\t\t\tpts: data.pes.PTS,\n\t\t\t\tpayload: data.pes.data_byte\n\t\t\t});\n\t\t}\n\t}\n\n\tflush() {\n\t\tif (this.frames.length > 0) {\n\t\t\tlet count = this.frames.length;\n\t\t\tlet firstFrame = this.frames[0];\n\t\t\tlet lastFrame = this.frames[count - 1];\n\t\t\tlet lastDuration = (lastFrame.sampleRate * lastFrame.sampleCount) / 90000;\n\n\t\t\tthis.frames.firstDTS = firstFrame.dts;\n\t\t\tthis.frames.firstPTS = firstFrame.pts;\n\n\t\t\tif (count === 1) {\n\t\t\t\tthis.frames.duration = lastDuration;\n\t\t\t} else {\n\t\t\t\tthis.frames.duration = lastDuration + (lastFrame.pts - firstFrame.pts);\n\t\t\t}\n\n\t\t\t// To prevent information mismatch leading to next pipeline decoding errors\n\t\t\t// Every audio frame list assembly needs to update track meta.\n\t\t\tthis._updateTrackMeta(firstFrame);\n\n\t\t\tthis.emit('data', this.frames);\n\n\t\t\tthis.reset();\n\t\t\tthis.emit('done');\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.trackId = null;\n\t\tthis._newFrames();\n\t}\n\n\t_newFrames() {\n\t\tthis.frames = []; // aac frames\n\t\tthis.frames.type = 'audio';\n\t\tthis.frames.byteLength = 0;\n\t\tthis.frames.duration = 0;\n\t\tthis.frames.firstDTS = 0;\n\t\tthis.frames.firstPTS = 0;\n\t}\n\n\t/**\n\t * @param {Object} frame\n\t */\n\t_updateTrackMeta(frame: AACFrame) {\n\t\tlet track = this.PSI.findTrack(this.trackId);\n\t\tlet config = getAudioConfig(frame.audioObjectType, frame.samplingFrequencyIndex, frame.channelCount);\n\t\ttrack.config = config.config;\n\t\ttrack.sampleRate = config.sampleRate;\n\t\ttrack.inputTimeScale = track.inputTimeScale || track.timescale;\n\t\ttrack.timescale = config.sampleRate;\n\t\ttrack.channelCount = config.channelCount;\n\t\ttrack.codec = config.codec;\n\t\ttrack.realCodec = config.realCodec;\n\t\ttrack.isAAC = true;\n\t}\n}\n\nexport default ADTSStream;\n","/**\n * @file: ep3b.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * discard the emulation_prevention_three_byte\n * @param data\n */\nexport default function discardEP3B(data: Uint8Array): Uint8Array {\n\tlet length = data.byteLength,\n\t\temulationPreventionBytesPositions = [],\n\t\ti = 1,\n\t\tnewLength: number,\n\t\tnewData = new Uint8Array(0);\n\n\t// Find all `Emulation Prevention Bytes`\n\twhile (i < length - 2) {\n\t\tif (data[i] === 0 && data[i + 1] === 0 && data[i + 2] === 0x03) {\n\t\t\temulationPreventionBytesPositions.push(i + 2);\n\t\t\ti += 2;\n\t\t} else {\n\t\t\ti++;\n\t\t}\n\t}\n\n\t// If no Emulation Prevention Bytes were found just return the original\n\t// array\n\tif (emulationPreventionBytesPositions.length === 0) {\n\t\treturn data;\n\t}\n\n\t// Create a new array to hold the NAL unit data\n\tnewLength = length - emulationPreventionBytesPositions.length;\n\n\ttry {\n\t\tnewData = new Uint8Array(newLength);\n\t} catch (e) {\n\t\tthrow `epsb alloc mem error ${newLength}`;\n\t}\n\tlet sourceIndex = 0;\n\n\tfor (i = 0; i < newLength; sourceIndex++, i++) {\n\t\tif (sourceIndex === emulationPreventionBytesPositions[0]) {\n\t\t\t// Skip this byte\n\t\t\tsourceIndex++;\n\t\t\t// Remove this position index\n\t\t\temulationPreventionBytesPositions.shift();\n\t\t}\n\t\tnewData[i] = data[sourceIndex];\n\t}\n\n\treturn newData;\n}\n","/**\n * @file: exp-golumb.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * exp golumb algorithm.\n * codeNum = 2leadingZeroBits – 1 + read_bits( leadingZeroBits )\n * @see https://en.wikipedia.org/wiki/Exponential-Golomb_coding\n */\n\n/**\n * read n bit.\n * @param buffer\n * @param bitOffset\n * @param length\n * @private\n */\nexport function readBit(buffer: Uint8Array, bitOffset: number = 0, length: number = 1): number {\n\tlet startByte = 0;\n\tlet startByteBitPos = 0;\n\tlet val = 0;\n\tlet bitStr = '',\n\t\tbitVal = 0;\n\n\tfor (let j = bitOffset; j < bitOffset + length; j++) {\n\t\tstartByte = Math.floor(j / 8);\n\t\tstartByteBitPos = 7 - (j % 8);\n\t\tbitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\n\n\t\tbitStr += bitVal;\n\t}\n\n\tval = parseInt(bitStr, 2);\n\n\treturn val;\n}\n\n/**\n * read 1 byte.\n * @param buffer\n * @param bitOffset\n */\nexport function readByte(buffer: Uint8Array, bitOffset: number = 0) {\n\treturn readBit(buffer, bitOffset, 8);\n}\n\n/**\n * Unsigned Integer Exp-Golomb Coded.\n * @param buffer\n * @param bitOffset\n */\nexport function readUEV(buffer: Uint8Array, bitOffset: number = 0) {\n\tlet leadingZeros = [];\n\tlet bitLength = buffer.byteLength * 8;\n\tlet readBit1 = false;\n\tlet startByte = 0;\n\tlet startByteBitPos = 0;\n\tlet bitVal = 0;\n\tlet value = '';\n\n\t// 1. 计算 leadingZeros\n\tfor (let i = bitOffset; i < bitLength; i++) {\n\t\tstartByte = Math.floor(i / 8);\n\t\tstartByteBitPos = 7 - (i % 8);\n\n\t\tbitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\n\n\t\tif (!readBit1) {\n\t\t\tif (bitVal === 0) {\n\t\t\t\tleadingZeros.push(0);\n\t\t\t} else {\n\t\t\t\treadBit1 = true;\n\t\t\t\tbitOffset = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tlet codeNumLength = leadingZeros.length + 1;\n\n\t// 2. 计算有效位数值\n\tfor (let j = bitOffset; j < bitOffset + codeNumLength; j++) {\n\t\tstartByte = Math.floor(j / 8);\n\t\tstartByteBitPos = 7 - (j % 8);\n\t\tbitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\n\n\t\tvalue += bitVal;\n\t}\n\n\treturn {\n\t\tbitLength: leadingZeros.length + codeNumLength,\n\t\tvalue: parseInt(value, 2) - 1\n\t};\n}\n\n/**\n * Signed Integer Exp-Golomb Coded.\n * @param buffer\n * @param bitOffset\n */\nexport function readSEV(buffer: Uint8Array, bitOffset: number = 0) {\n\tlet uev = readUEV(buffer, bitOffset);\n\tlet codeNum = uev.value;\n\n\tlet signedValue = Math.pow(-1, codeNum + 1) * Math.ceil(codeNum / 2);\n\n\treturn {\n\t\tbitLength: uev.bitLength,\n\t\tvalue: signedValue\n\t};\n}\n\nexport default {\n\treadUEV,\n\treadSEV,\n\treadBit,\n\treadByte\n};\n","/**\n * @file: sps.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport ExpGolomb from '../../util/exp-golumb';\n\nlet bitOffset = 0;\n\nexport type SPSProps = {\n\tprofile_idc: number;\n\tprofile_compatibility: number;\n\tlevel_idc: number;\n\tsps_id: number;\n\tlog2_max_frame_num_minus4: number;\n\tpic_order_cnt_type: number;\n\tlog2_max_pic_order_cnt_lsb_minus4: number;\n\n\twidth: number;\n\theight: number;\n\n\tpixelRatio: [number, number];\n\tpayload: Uint8Array;\n\n\tvideo_format: number;\n\n\tfps: number;\n\tfixedFPS: boolean;\n};\n\n/**\n * 7.3.2.1.1.1 Scaling list syntax\n * @param scalingList\n * @param size\n */\nfunction scaling_list(scalingList, size) {\n\tlet lastScale = 8;\n\tlet nextScale = 8;\n\tlet delta_scale;\n\n\tfor (var j = 0; j < size; j++) {\n\t\tif (nextScale != 0) {\n\t\t\tdelta_scale = ExpGolomb.readUEV(scalingList, bitOffset);\n\t\t\tbitOffset += delta_scale.bitLength;\n\n\t\t\tnextScale = (lastScale + delta_scale.value + 256) % 256;\n\t\t}\n\n\t\tlastScale = scalingList[j];\n\t}\n}\n\n/**\n * decode (SPS)Sequence parameter set\n * @param payload\n */\nexport function decodeSPS(payload: Uint8Array): SPSProps {\n\tbitOffset = 0;\n\n\tlet profile_idc = payload[0];\n\tlet profile_compatibility = payload[1];\n\tlet level_idc = payload[2];\n\tlet golombBuffer = payload.subarray(3);\n\tlet separate_colour_plane_flag = 0,\n\t\tqpprime_y_zero_transform_bypass_flag = 0,\n\t\tseq_scaling_matrix_present_flag = 0;\n\tlet lmpoclmUEV;\n\tlet delta_pic_order_always_zero_flag = 0,\n\t\tofnrpSEV,\n\t\tofttbfSEV,\n\t\tnrfipoccUEV;\n\tlet pixelRatio: [number, number] = [1, 1],\n\t\tpixelScale = 1;\n\tlet video_format: number;\n\tlet fps = 0,\n\t\tnum_units_in_tick: number,\n\t\ttime_scale: number,\n\t\tfixed_frame_rate_flag: boolean = true;\n\n\t// seq_parameter_set_id\n\tlet spsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += spsUEV.bitLength;\n\n\tif (\n\t\tprofile_idc == 100 ||\n\t\tprofile_idc == 110 ||\n\t\tprofile_idc == 122 ||\n\t\tprofile_idc == 244 ||\n\t\tprofile_idc == 44 ||\n\t\tprofile_idc == 83 ||\n\t\tprofile_idc == 86 ||\n\t\tprofile_idc == 118 ||\n\t\tprofile_idc == 128\n\t) {\n\t\t// chroma_format_idc\n\t\tlet chromaFIUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += chromaFIUEV.bitLength;\n\n\t\tif (chromaFIUEV.value == 3) {\n\t\t\t// separate_colour_plane_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\tbitOffset += 1;\n\t\t}\n\n\t\t// bit_depth_luma_minus8\n\t\tlet bitdlmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += bitdlmUEV.bitLength;\n\n\t\t// bit_depth_chroma_minus8\n\t\tlet bitdcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += bitdcmUEV.bitLength;\n\n\t\t// qpprime_y_zero_transform_bypass_flag\n\t\t// qpprime_y_zero_transform_bypass_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\t// seq_scaling_matrix_present_flag\n\t\tseq_scaling_matrix_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (seq_scaling_matrix_present_flag) {\n\t\t\tfor (let i = 0; i < (chromaFIUEV.value != 3 ? 8 : 12); i++) {\n\t\t\t\tlet seq_scaling_list_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\t\tbitOffset += 1;\n\n\t\t\t\tif (seq_scaling_list_present_flag) {\n\t\t\t\t\tif (i < 6) {\n\t\t\t\t\t\tscaling_list(golombBuffer, 16);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscaling_list(golombBuffer, 64);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// log2_max_frame_num_minus4\n\tlet lmfnmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += lmfnmUEV.bitLength;\n\n\t// pic_order_cnt_type\n\tlet poctUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tlet pic_order_cnt_type = poctUEV.value;\n\tbitOffset += poctUEV.bitLength;\n\n\tif (pic_order_cnt_type === 0) {\n\t\t// log2_max_pic_order_cnt_lsb_minus4\n\t\tlmpoclmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += lmpoclmUEV.bitLength;\n\t} else if (pic_order_cnt_type === 1) {\n\t\t// delta_pic_order_always_zero_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\t// offset_for_non_ref_pic\n\t\tofnrpSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\t\tbitOffset += ofnrpSEV.bitLength;\n\n\t\t// offset_for_top_to_bottom_field\n\t\tofttbfSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\t\tbitOffset += ofttbfSEV.bitLength;\n\n\t\t// num_ref_frames_in_pic_order_cnt_cycle\n\t\tnrfipoccUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += nrfipoccUEV.bitLength;\n\n\t\t// let offset_for_ref_frames = [];\n\t\tfor (let i = 0, item; i < nrfipoccUEV.value; i++) {\n\t\t\titem = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\t\t\tbitOffset += item.bitLength;\n\n\t\t\t// offset_for_ref_frames.push(item);\n\t\t}\n\t}\n\n\t// max_num_ref_frames\n\t// 指定参考帧队列可能达到的最大长度，解码器依照这个句法元素的值开辟存储区，这个存储区用于存放已解码的参考帧，\n\t// H.264 规定最多可用 16 个参考帧，本句法元素的值最大为 16。值得注意的是这个长度以帧为单位，如果在场模式下，应该相应地扩展一倍\n\tlet mnrfUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += mnrfUEV.bitLength;\n\n\t// gaps_in_frame_num_value_allowed_flag\n\t// let gaps_in_frame_num_value_allowed_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// pic_width_in_mbs_minus1\n\tlet picWidthUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += picWidthUEV.bitLength;\n\n\t// pic_height_in_map_units_minus1\n\tlet picHeightUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += picHeightUEV.bitLength;\n\n\t// frame_mbs_only_flag\n\t// 本句法元素等于 1 时, 表示本序列中所有图像的编码模式都是帧编码；\n\t// 本句法元素等于 0 时, 表示本序列中图像的编码模式可能是帧，也可能是场或帧场自适应，某个图像具体是哪一种要由其他句法元素决定。\n\tlet frame_mbs_only_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\tif (!frame_mbs_only_flag) {\n\t\t// mb_adaptive_frame_field_flag (Unused, Unnecessary to read it.)\n\t\t// ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\t}\n\n\t// direct_8x8_inference_flag,  用于指明 B 片的直接 和 skip 模式下运动矢量的预测方法\n\t// let direct_8x8_inference_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// frame_cropping_flag, 用于指明解码器是否要将图像裁剪后输出，如果是的话，后面紧跟着的四个句法元素分别指出左右、上下裁剪的宽度\n\tlet frame_cropping_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\tlet cropLeft = 0,\n\t\tcropRight = 0,\n\t\tcropTop = 0,\n\t\tcropBottom = 0;\n\tif (frame_cropping_flag) {\n\t\tlet fcloUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += fcloUEV.bitLength;\n\t\tcropLeft = fcloUEV.value;\n\n\t\tlet fcroUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += fcroUEV.bitLength;\n\t\tcropRight = fcroUEV.value;\n\n\t\tlet fctoUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += fctoUEV.bitLength;\n\t\tcropTop = fctoUEV.value;\n\n\t\tlet fcboUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += fcboUEV.bitLength;\n\t\tcropBottom = fcboUEV.value;\n\t}\n\n\t// vui_parameters_present_flag\n\tlet vui_parameters_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\tif (vui_parameters_present_flag) {\n\t\t// Annex E, E.1.1 VUI parameters syntax\n\t\t// VUI 用以表征视频格式等额外信息\n\t\t// aspect_ratio, video_format\n\n\t\tlet aspect_ratio_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (aspect_ratio_info_present_flag) {\n\t\t\tconst aspectRatioIdc = ExpGolomb.readByte(golombBuffer, bitOffset);\n\t\t\tbitOffset += 8;\n\n\t\t\tswitch (aspectRatioIdc) {\n\t\t\t\tcase 1:\n\t\t\t\t\tpixelRatio = [1, 1];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tpixelRatio = [12, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tpixelRatio = [10, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tpixelRatio = [16, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tpixelRatio = [40, 33];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\tpixelRatio = [24, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 7:\n\t\t\t\t\tpixelRatio = [20, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\tpixelRatio = [32, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 9:\n\t\t\t\t\tpixelRatio = [80, 33];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 10:\n\t\t\t\t\tpixelRatio = [18, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 11:\n\t\t\t\t\tpixelRatio = [15, 11];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 12:\n\t\t\t\t\tpixelRatio = [64, 33];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 13:\n\t\t\t\t\tpixelRatio = [160, 99];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 14:\n\t\t\t\t\tpixelRatio = [4, 3];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 15:\n\t\t\t\t\tpixelRatio = [3, 2];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 16:\n\t\t\t\t\tpixelRatio = [2, 1];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 255: {\n\t\t\t\t\tlet width0 = ExpGolomb.readByte(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += 8;\n\t\t\t\t\tlet width1 = ExpGolomb.readByte(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += 8;\n\t\t\t\t\tlet height0 = ExpGolomb.readByte(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += 8;\n\t\t\t\t\tlet height1 = ExpGolomb.readByte(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += 8;\n\t\t\t\t\tpixelRatio = [(width0 << 8) | width1, (height0 << 8) | height1];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (pixelRatio) {\n\t\t\t\tpixelScale = pixelRatio[0] / pixelRatio[1];\n\t\t\t}\n\n\t\t\tif (aspectRatioIdc === 255) {\n\t\t\t\t// sar_width\n\t\t\t\tbitOffset += 16;\n\t\t\t\t// sar_height\n\t\t\t\tbitOffset += 16;\n\t\t\t}\n\t\t}\n\n\t\tlet overscan_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (overscan_info_present_flag) {\n\t\t\tbitOffset += 1;\n\t\t\t// overscan_appropriate_flag;\n\t\t}\n\n\t\tlet video_signal_type_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (video_signal_type_present_flag) {\n\t\t\t/*\n                Table E-2 – Meaning of video_format\n                video_format    Meaning\n                0               Component\n                1               PAL\n                2               NTSC\n                3               SECAM\n                4               MAC\n                5               Unspecified video format\n                6               Reserved\n                7               Reserved\n             */\n\t\t\tvideo_format = ExpGolomb.readBit(golombBuffer, bitOffset, 3);\n\t\t\tbitOffset += 3;\n\n\t\t\t// switch (video_format) {\n\t\t\t// }\n\n\t\t\t// let video_full_range_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\tbitOffset += 1;\n\n\t\t\tlet colour_description_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\tbitOffset += 1;\n\n\t\t\tif (colour_description_present_flag) {\n\t\t\t\t// colour_primaries            u(8)\n\t\t\t\t// transfer_characteristics    u(8)\n\t\t\t\t// matrix_coefficients         u(8)\n\t\t\t\tbitOffset += 24;\n\t\t\t}\n\t\t}\n\n\t\tlet chroma_loc_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (chroma_loc_info_present_flag) {\n\t\t\tlet chroma_sample_loc_type_top_field = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\tbitOffset += chroma_sample_loc_type_top_field.bitLength;\n\n\t\t\tlet chroma_sample_loc_type_bottom_field = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\tbitOffset += chroma_sample_loc_type_bottom_field.bitLength;\n\t\t}\n\n\t\tlet timing_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\tbitOffset += 1;\n\n\t\tif (timing_info_present_flag) {\n\t\t\tnum_units_in_tick = ExpGolomb.readBit(golombBuffer, bitOffset, 32);\n\t\t\tbitOffset += 32;\n\n\t\t\ttime_scale = ExpGolomb.readBit(golombBuffer, bitOffset, 32);\n\t\t\tbitOffset += 32;\n\n\t\t\tfixed_frame_rate_flag = !!ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\tbitOffset += 1;\n\n\t\t\tfps = time_scale / (num_units_in_tick * 2);\n\t\t}\n\n\t\t// There is left VUI other's parameters to be decoded ...\n\t\t// For now, it is useless, so don't pass them.\n\t}\n\n\t// let FrameHeightInMbs = (2 - frame_mbs_only_flag) * (picHeightUEV.value + 1);\n\t// PicSizeInMapUnits = PicWidthInMbs * PicHeightInMapUnits\n\n\treturn {\n\t\tpayload: golombBuffer,\n\n\t\tprofile_idc,\n\t\tprofile_compatibility,\n\t\tlevel_idc,\n\t\tsps_id: spsUEV.value, // ue(v)\n\t\tlog2_max_frame_num_minus4: poctUEV.value, // ue(v)\n\t\tpic_order_cnt_type, // ue(v)\n\t\tlog2_max_pic_order_cnt_lsb_minus4: lmpoclmUEV ? lmpoclmUEV.value : 0, // ue(v)\n\n\t\twidth: Math.ceil(((picWidthUEV.value + 1) * 16 - cropLeft * 2 - cropRight * 2) * pixelScale), // PicWidthInSamplesL = PicWidthInMbs * 16\n\t\theight: (2 - frame_mbs_only_flag) * (picHeightUEV.value + 1) * 16 - cropTop * 2 - cropBottom * 2,\n\n\t\tpixelRatio,\n\t\tvideo_format,\n\n\t\tfps,\n\t\tfixedFPS: fixed_frame_rate_flag\n\t};\n}\n","/**\n * @file: pps.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport ExpGolomb from '../../util/exp-golumb';\n\nexport type PPSProps = {\n\tsliceGroupNum: number;\n};\n\n/**\n * decode (PPS)Picture parameter set\n * @param payload\n */\nexport function decodePPS(payload: Uint8Array): PPSProps {\n\tlet bitOffset = 0;\n\n\tlet golombBuffer = payload;\n\tlet slice_group_change_direction_flag = 0,\n\t\tsliceGroupIds = [];\n\tlet sgcdfUEV, picSizeUEV;\n\tlet i = 0;\n\n\t// pic_parameter_set_id\n\tlet ppsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += ppsUEV.bitLength;\n\n\t// seq_parameter_set_id\n\tlet spsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += spsUEV.bitLength;\n\n\t// entropy_coding_mode_flag\n\t// 0: Exp-Golomb coded, see subclause 9.1 or CAVLC, see subclause 9.2\n\t// 1: CABAC, see subclause 9.3\n\tlet entropy_coding_mode_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// bottom_field_pic_order_in_frame_present_flag\n\tlet bottom_field_pic_order_in_frame_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// num_slice_groups_minus1,\n\tlet sliceGroupUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += sliceGroupUEV.bitLength;\n\n\tif (sliceGroupUEV.value > 0) {\n\t\t// slice_group_map_type\n\t\tlet sgmtUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\tbitOffset += sgmtUEV.bitLength;\n\n\t\tlet iGroup = 0,\n\t\t\titemUev;\n\n\t\tswitch (sgmtUEV.value) {\n\t\t\tcase 0:\n\t\t\t\tfor (iGroup = 0; iGroup <= sgmtUEV.value; iGroup++) {\n\t\t\t\t\t// run_length_minus1\n\t\t\t\t\titemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += itemUev.bitLength;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tfor (iGroup = 0; iGroup <= sgmtUEV.value; iGroup++) {\n\t\t\t\t\t// top_left\n\t\t\t\t\titemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += itemUev.bitLength;\n\t\t\t\t\t// bottom_right\n\t\t\t\t\titemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += itemUev.bitLength;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\tcase 4:\n\t\t\tcase 5:\n\t\t\t\t// slice_group_change_direction_flag\n\t\t\t\tslice_group_change_direction_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\t\t\t\tbitOffset += 1;\n\t\t\t\t// slice_group_change_rate_minus1\n\t\t\t\tsgcdfUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\t\tbitOffset += sgcdfUEV.bitLength;\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\t{\n\t\t\t\t\t// pic_size_in_map_units_minus1\n\t\t\t\t\tpicSizeUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\t\t\t\t\tbitOffset += picSizeUEV.bitLength;\n\n\t\t\t\t\tlet length = Math.ceil(Math.log2(sliceGroupUEV.value + 1));\n\t\t\t\t\tfor (i = 0; i <= picSizeUEV.value; i++) {\n\t\t\t\t\t\t// pic_size_in_map_units_minus1\n\t\t\t\t\t\tsliceGroupIds.push(ExpGolomb.readBit(golombBuffer, bitOffset, length));\n\t\t\t\t\t\tbitOffset += length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t// num_ref_idx_l0_default_active_minus1\n\tlet nril0dcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += nril0dcmUEV.bitLength;\n\n\t// num_ref_idx_l1_default_active_minus1\n\tlet nril1dcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\n\tbitOffset += nril1dcmUEV.bitLength;\n\n\t// weighted_pred_flag\n\tlet weighted_pred_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// weighted_bipred_idc\n\tlet weighted_bipred_idc = ExpGolomb.readBit(golombBuffer, bitOffset, 2);\n\tbitOffset += 1;\n\n\t// pic_init_qp_minus26\n\tlet piqpSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\tbitOffset += piqpSEV.bitLength;\n\t// pic_init_qs_minus26\n\tlet piqsSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\tbitOffset += piqsSEV.bitLength;\n\t// chroma_qp_index_offset\n\tlet cqioSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\n\tbitOffset += cqioSEV.bitLength;\n\n\tlet deblocking_filter_control_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\tlet constrained_intra_pred_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\tlet redundant_pic_cnt_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\n\tbitOffset += 1;\n\n\t// if( more_rbsp_data( ) ) {\n\t//     // Unused data...\n\t// }\n\n\treturn {\n\t\tsliceGroupNum: sliceGroupUEV.value + 1\n\t};\n}\n","/**\n * @file: pps.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nexport type SEIProps = {};\n\n/**\n * decode (SEI)Supplemental enhancement information\n * @param payload\n */\nexport function decodeSEI(payload: Uint8Array): SEIProps {\n\treturn {};\n}\n","/**\n * @file: nalu.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport DataViewReader from '../../util/dv';\nimport NaluTypes from '../../enum/nalu-types';\nimport discardEP3B from './ep3b';\nimport { decodeSPS, SPSProps } from './sps';\nimport { decodePPS, PPSProps } from './pps';\nimport { decodeSEI, SEIProps } from './sei';\n\n/**\n * decode (AUD)Access unit delimiter\n * @param payload\n * @private\n */\nfunction _decodeAUD(payload: Uint8Array): number {\n\t// var primary_pic_type_table = {\n\t//     0x084, // 2, 7\n\t//     0x0a5, // 0, 2, 5, 7\n\t//     0x0e7, // 0, 1, 2, 5, 6, 7\n\t//     0x210, // 4, 9\n\t//     0x318, // 3, 4, 8, 9\n\t//     0x294, // 2, 4, 7, 9\n\t//     0x3bd, // 0, 2, 3, 4, 5, 7, 8, 9\n\t//     0x3ff, // 0, 1, 2, 3, 4, 5, 6, 7, 8, 9\n\t// }\n\n\treturn payload[0] >> 5;\n}\n\nexport default class NALU extends DataViewReader {\n\tforbidden_zero_bit: number;\n\tref_idc: number;\n\tunit_type: number;\n\tdata: Uint8Array;\n\trawData: Uint8Array;\n\tsps: SPSProps;\n\tpps: PPSProps;\n\tsei: SEIProps;\n\tprimary_pic_type: number;\n\tpts?: number;\n\tdts?: number;\n\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\tthis.forbidden_zero_bit = buffer[0] >> 7;\n\n\t\t// nalu priority.\n\t\tthis.ref_idc = (buffer[0] >> 5) & 0x03;\n\n\t\t// specifies the type of RBSP data structure. see in mux-nalu-types.js\n\t\tthis.unit_type = buffer[0] & 0x1f;\n\n\t\tthis.data = discardEP3B(buffer.subarray(1));\n\t\tthis.rawData = buffer;\n\n\t\tswitch (this.unit_type) {\n\t\t\tcase NaluTypes.NON_IDR_SLICE:\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.DPA_SLICE:\n\t\t\tcase NaluTypes.DPB_SLICE:\n\t\t\tcase NaluTypes.DPC_SLICE:\n\t\t\t\t// TODO decode A/B/C Partition Slice.\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.IDR_SLICE:\n\t\t\t\t// this.data = decodeSlice(this.data).data;\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.SPS:\n\t\t\t\tthis.sps = decodeSPS(this.data);\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.PPS:\n\t\t\t\tthis.pps = decodePPS(this.data);\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.SEI:\n\t\t\t\tthis.sei = decodeSEI(this.data);\n\t\t\t\tbreak;\n\t\t\tcase NaluTypes.AUD:\n\t\t\t\tthis.primary_pic_type = _decodeAUD(this.data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","/**\n * @file: avc.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * h.264/AVC codec\n */\nimport EventEmitter from '../util/event-emitter';\nimport NALUnit from './avc/nalu';\n\ninterface CachedBytes extends Uint8Array {\n\tpts?: number;\n\tdts?: number;\n\tstartCodeLength?: number;\n}\n\nexport type AVCCodecData = {\n\tpts: number;\n\tdts: number;\n\tnaluSizeLength?: number;\n\tpayload: Uint8Array;\n};\n\nexport interface AVCDecoderConfigurationRecord {\n\tversion: number;\n\tprofile: number;\n\tprofileCompatibility: number;\n\tlevel: number;\n\tnaluSizeLength: number;\n\tspsNalus: Uint8Array[];\n\tppsNalus: Uint8Array[];\n}\n\nexport class AVCCodec extends EventEmitter {\n\tprivate cachedBytes?: CachedBytes;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.cachedBytes = null;\n\t}\n\n\tpush(data: AVCCodecData) {\n\t\tlet self = this;\n\t\tlet i = 0,\n\t\t\tnaluOffset = 0,\n\t\t\tlastStartCodeLength = 0;\n\t\tlet { pts, dts, payload, naluSizeLength } = data;\n\t\tlet data_byte;\n\n\t\tif (this.cachedBytes) {\n\t\t\ttry {\n\t\t\t\tdata_byte = new Uint8Array(this.cachedBytes.byteLength + payload.byteLength);\n\t\t\t} catch (e) {\n\t\t\t\tthrow `h264 alloc mem error ${this.cachedBytes.byteLength}/${payload.byteLength}`;\n\t\t\t}\n\t\t\tdata_byte.set(this.cachedBytes);\n\t\t\tdata_byte.set(payload, this.cachedBytes.byteLength);\n\t\t} else {\n\t\t\tdata_byte = payload;\n\t\t}\n\n\t\tif (!naluSizeLength) {\n\t\t\tlet j = data_byte.byteLength - 1;\n\t\t\tlet dropZerosLength = 0;\n\n\t\t\t// Collect tailing zeros.\n\t\t\t// end with 0x000000 and more...\n\t\t\tdo {\n\t\t\t\tif (data_byte[j] === 0x00) {\n\t\t\t\t\tdropZerosLength++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tj--;\n\t\t\t} while (j > 0);\n\n\t\t\tif (dropZerosLength >= 3) {\n\t\t\t\t// drop tailing zeros.\n\t\t\t\tdata_byte = data_byte.subarray(0, j + 1);\n\t\t\t}\n\n\t\t\tdo {\n\t\t\t\tlet uint32 =\n\t\t\t\t\t(data_byte[i] << 24) | (data_byte[i + 1] << 16) | (data_byte[i + 2] << 8) | data_byte[i + 3];\n\t\t\t\tlet start_code = data_byte.length - i >= 4 ? uint32 : -1;\n\t\t\t\tlet start_code_length = 0;\n\t\t\t\tlet isLastByte = i === data_byte.length - 1;\n\n\t\t\t\tif (start_code >> 8 === 1) {\n\t\t\t\t\t/*commence with 3 bytes*/\n\t\t\t\t\tstart_code_length = 3;\n\t\t\t\t} else if (start_code === 1) {\n\t\t\t\t\t/*commence with 4 bytes*/\n\t\t\t\t\tstart_code_length = 4;\n\t\t\t\t}\n\n\t\t\t\tif (start_code_length === 3 || start_code_length === 4 || isLastByte) {\n\t\t\t\t\tlet startPos = naluOffset + lastStartCodeLength;\n\t\t\t\t\tlet isNaluEndByte = isLastByte && dropZerosLength >= 3;\n\n\t\t\t\t\tif (i > naluOffset && (!isLastByte || isNaluEndByte)) {\n\t\t\t\t\t\tlet bytes = data_byte.subarray(startPos, isNaluEndByte ? i + 1 : i);\n\t\t\t\t\t\tlet nalu = new NALUnit(bytes);\n\n\t\t\t\t\t\t// PES\n\t\t\t\t\t\tnalu.pts = pts;\n\t\t\t\t\t\tnalu.dts = dts;\n\n\t\t\t\t\t\tself.emit('nalu', nalu);\n\t\t\t\t\t\tnaluOffset = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isLastByte) {\n\t\t\t\t\t\tif (dropZerosLength < 3) {\n\t\t\t\t\t\t\tthis.cachedBytes = data_byte.subarray(naluOffset);\n\t\t\t\t\t\t\tthis.cachedBytes.pts = pts;\n\t\t\t\t\t\t\tthis.cachedBytes.dts = dts;\n\t\t\t\t\t\t\tthis.cachedBytes.startCodeLength = lastStartCodeLength;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.cachedBytes = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i === naluOffset) {\n\t\t\t\t\t\t// record last start code length.\n\t\t\t\t\t\tlastStartCodeLength = start_code_length;\n\t\t\t\t\t}\n\n\t\t\t\t\ti += start_code_length || 1;\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t} while (i < data_byte.length);\n\t\t} else {\n\t\t\tlet startPos = 0,\n\t\t\t\tsize = 0,\n\t\t\t\tendPos = 0;\n\t\t\tdo {\n\t\t\t\tsize = 0;\n\t\t\t\tfor (let k = 0; k < naluSizeLength; k++) {\n\t\t\t\t\tsize = size | (data_byte[startPos + k] << ((naluSizeLength - k - 1) * 8));\n\t\t\t\t}\n\t\t\t\t// size = (data_byte[i] << 24) | (data_byte[i + 1] << 16) | (data_byte[i + 2] << 8) | data_byte[i + 3];\n\t\t\t\tstartPos += naluSizeLength;\n\t\t\t\tendPos = startPos + size;\n\t\t\t\tif (endPos > data_byte.length) {\n\t\t\t\t\tendPos = data_byte.length;\n\t\t\t\t}\n\n\t\t\t\tlet bytes = data_byte.subarray(startPos, endPos);\n\t\t\t\tlet nalu = new NALUnit(bytes);\n\t\t\t\t// PES\n\t\t\t\tnalu.pts = pts;\n\t\t\t\tnalu.dts = dts;\n\n\t\t\t\tself.emit('nalu', nalu);\n\t\t\t\tstartPos = endPos;\n\t\t\t} while (startPos < data_byte.length);\n\t\t}\n\n\t\tif (this.cachedBytes) {\n\t\t\tlet nalu = new NALUnit(this.cachedBytes.subarray(this.cachedBytes.startCodeLength));\n\n\t\t\tnalu.pts = this.cachedBytes.pts;\n\t\t\tnalu.dts = this.cachedBytes.dts;\n\n\t\t\tthis.emit('nalu', nalu);\n\n\t\t\tthis.cachedBytes = null;\n\t\t}\n\n\t\tthis.emit('done');\n\t}\n\n\treset() {\n\t\tthis.cachedBytes = null;\n\t}\n}\n","/**\n * @file: avc-config.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport { SPSProps } from './sps';\nimport { PPSProps } from './pps';\n\n/**\n * AVC Config Helper\n * Accord sps/pps, generate mimeType info.\n */\nexport default (sps: SPSProps, pps?: PPSProps) => {\n\tlet profile_idc = sps.profile_idc;\n\tlet profile_compatibility = sps.profile_compatibility;\n\tlet level_idc = sps.level_idc;\n\tlet codecString = 'avc1.';\n\n\tlet arr = [profile_idc, profile_compatibility, level_idc];\n\tfor (let j = 0; j < arr.length; j++) {\n\t\tlet h = arr[j].toString(16);\n\t\tif (h.length < 2) {\n\t\t\th = '0' + h;\n\t\t}\n\t\tcodecString += h;\n\t}\n\n\treturn {\n\t\tcodec: codecString\n\t};\n};\n","/**\n * @file: avc.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * H.264/AVC/HEVC Stream.\n */\nimport { AVCCodec, AVCCodecData } from '../../codec/avc';\nimport getAVCConfig from '../../codec/avc/avc-config';\nimport NALU from '../../codec/avc/nalu';\nimport NaluTypes from '../../enum/nalu-types';\nimport StreamType from '../../enum/stream-types';\nimport logger from '../../util/logger';\nimport Stream from '../../util/stream';\nimport PSI from '../psi';\nimport { AVCFrame, GOP, GOPVector, PESStreamEmitData } from '../types/pipeline';\n\nclass H264Stream extends Stream {\n\tprivate PSI: PSI;\n\tprivate trackId?: number;\n\tprivate currentFrame: AVCFrame;\n\tprivate prevFrame: AVCFrame;\n\tprivate codec: AVCCodec;\n\tprivate gop: GOP;\n\tprivate gops: GOPVector;\n\n\tconstructor(psi: PSI) {\n\t\tsuper();\n\n\t\tthis.PSI = psi;\n\t\tthis.trackId = null;\n\n\t\t/** @private {Array} */\n\t\tthis.currentFrame = []; // a group of nalu\n\n\t\t/** @private {AVCCodec} */\n\t\tthis.codec = new AVCCodec();\n\n\t\tthis._newGop();\n\t\tthis._newGops();\n\n\t\tthis.codec.on('nalu', (nalu: NALU) => {\n\t\t\tif (nalu.unit_type === NaluTypes.SPS) {\n\t\t\t\tlet track = this.PSI.findTrack(this.trackId);\n\t\t\t\tlet config = getAVCConfig(nalu.sps);\n\n\t\t\t\t// write sps info to video track.\n\t\t\t\ttrack.codec = config.codec;\n\t\t\t\ttrack.width = nalu.sps.width;\n\t\t\t\ttrack.height = nalu.sps.height;\n\t\t\t\ttrack.profileIdc = nalu.sps.profile_idc;\n\t\t\t\ttrack.profileCompatibility = nalu.sps.profile_compatibility;\n\t\t\t\ttrack.levelIdc = nalu.sps.level_idc;\n\t\t\t\ttrack.pixelRatio = nalu.sps.pixelRatio;\n\t\t\t\ttrack.sps = [nalu.rawData];\n\t\t\t} else if (nalu.unit_type === NaluTypes.PPS) {\n\t\t\t\tlet track = this.PSI.findTrack(this.trackId);\n\t\t\t\ttrack.pps = [nalu.rawData];\n\t\t\t}\n\n\t\t\tthis._grouping(nalu);\n\t\t});\n\t}\n\n\t/**\n\t * Push a complete pes\n\t * @param data\n\t */\n\tpush(data: PESStreamEmitData) {\n\t\tconst { stream_type, pes, pid } = data;\n\t\tif (stream_type === StreamType.H264 || stream_type === StreamType.HEVC) {\n\t\t\tthis.trackId = pid;\n\n\t\t\tlet rawData: AVCCodecData = {\n\t\t\t\tpts: pes.PTS,\n\t\t\t\tdts: pes.DTS,\n\t\t\t\tpayload: pes.data_byte\n\t\t\t};\n\n\t\t\tthis.codec.push(rawData);\n\t\t}\n\t}\n\n\tflush() {\n\t\t// Push last frame into gop.\n\t\tif (this.currentFrame.length > 0) {\n\t\t\t// If the last frame has valid duration, use the duration of the previous frame\n\t\t\tif (!this.currentFrame.duration || this.currentFrame.duration <= 0) {\n\t\t\t\tthis.currentFrame.duration = this.prevFrame.duration || 0;\n\t\t\t}\n\n\t\t\tthis._pushFrameIntoGop();\n\t\t\tthis.currentFrame = [];\n\t\t}\n\n\t\t// Push last gop.\n\t\tif (this.gop.length > 0) {\n\t\t\tthis._pushGopIntoGroup();\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.codec.reset();\n\n\t\tthis.currentFrame = [];\n\t\tthis._newGop();\n\t\tthis._newGops();\n\t}\n\n\t/**\n\t * Group nalu into frame & gop.\n\t * @param currentNal\n\t * @private\n\t */\n\t_grouping(currentNal) {\n\t\tif (currentNal.unit_type === NaluTypes.AUD) {\n\t\t\tif (this.currentFrame.length > 0) {\n\t\t\t\tthis.currentFrame.duration = currentNal.dts - this.currentFrame.dts;\n\n\t\t\t\tif (this.gop.length > 0 && this.currentFrame.keyframe) {\n\t\t\t\t\tthis.gop.trackId = this.trackId;\n\n\t\t\t\t\tthis._pushGopIntoGroup();\n\t\t\t\t}\n\n\t\t\t\t// the gop should commence with a key frame,\n\t\t\t\t// or the frame will be dropped until finding one that contains a key frame.\n\t\t\t\tif (this.currentFrame.keyframe || this.gop.length > 0) {\n\t\t\t\t\tthis._pushFrameIntoGop();\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(`h264 codec drop frame`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.prevFrame = this.currentFrame;\n\n\t\t\t// end a frame.\n\t\t\tthis.currentFrame = [];\n\t\t\tthis.currentFrame.keyframe = false;\n\t\t\tthis.currentFrame.byteLength = 0;\n\t\t\tthis.currentFrame.naluCount = 0;\n\t\t\tthis.currentFrame.pts = currentNal.pts;\n\t\t\tthis.currentFrame.dts = currentNal.dts;\n\t\t} else {\n\t\t\tif (currentNal.unit_type === NaluTypes.IDR_SLICE) {\n\t\t\t\tthis.currentFrame.keyframe = true;\n\t\t\t}\n\n\t\t\tthis.currentFrame.byteLength += currentNal.rawData.byteLength;\n\t\t\tthis.currentFrame.naluCount++;\n\t\t\tthis.currentFrame.push(currentNal);\n\t\t}\n\n\t\tthis.currentFrame.duration = currentNal.dts - this.currentFrame.dts;\n\t}\n\n\t_newGop() {\n\t\tthis.gop = []; // a group of idr-start-frame sequence\n\n\t\tthis.gop.duration = 0;\n\t\tthis.gop.naluCount = 0;\n\t\tthis.gop.byteLength = 0;\n\t}\n\n\t_pushFrameIntoGop() {\n\t\t// Gop\n\t\tthis.gop.push(this.currentFrame);\n\t\tthis.gop.duration += this.currentFrame.duration;\n\t\tthis.gop.byteLength += this.currentFrame.byteLength;\n\t\tthis.gop.naluCount += this.currentFrame.naluCount;\n\t}\n\n\t_newGops() {\n\t\tthis.gops = []; // a group of gop\n\t\tthis.gops.type = 'video';\n\t\tthis.gops.duration = 0;\n\t\tthis.gops.naluCount = 0;\n\t\tthis.gops.byteLength = 0;\n\t\tthis.gops.frameLength = 0;\n\t\tthis.gops.firstDTS = 0;\n\t}\n\n\t_pushGopIntoGroup() {\n\t\tlet firstFrame = this.gop[0];\n\t\t// GOPs\n\t\tthis.gops.trackId = this.trackId;\n\t\tthis.gops.duration += this.gop.duration;\n\t\tthis.gops.byteLength += this.gop.byteLength;\n\t\tthis.gops.naluCount += this.gop.naluCount;\n\t\tthis.gops.frameLength += this.gop.length;\n\t\tthis.gops.firstDTS = firstFrame.dts;\n\t\tthis.gops.firstPTS = firstFrame.pts;\n\n\t\tthis.gops.push(this.gop);\n\n\t\tthis.emit('data', this.gops);\n\n\t\tthis._newGop();\n\t\tthis._newGops();\n\n\t\tthis.emit('done');\n\t}\n}\n\nexport default H264Stream;\n","/**\n * @file: elementary.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Elementary Stream.\n * @summary An elementary stream (ES) as defined by the MPEG communication protocol is usually the output of an audio or video encoder.\n *      ES contains only one kind of data, e.g. audio, video or closed caption.\n * @description  https://en.wikipedia.org/wiki/Elementary_stream\n */\nimport StreamType from '../../enum/stream-types';\nimport { Context, GlobalOptions } from '../../types/globals';\nimport { isNumber } from '../../util/is';\nimport logger from '../../util/logger';\nimport Stream from '../../util/stream';\nimport PSI from '../psi';\nimport { PESStreamEmitData, GOPVector } from '../types/pipeline';\nimport ADTSStream from './adts';\nimport AVCStream from './avc';\n\nclass ElementaryStream extends Stream {\n\tprivate context: Context;\n\tprivate PSI: PSI;\n\tprivate options: GlobalOptions;\n\tprivate tracks: Array<GOPVector>;\n\tprivate adtsStream: ADTSStream;\n\tprivate avcStream: AVCStream;\n\tprivate streams: [ADTSStream, AVCStream];\n\n\tconstructor(ctx: Context, psi: PSI, options: GlobalOptions = {}) {\n\t\tsuper();\n\n\t\tthis.context = ctx;\n\t\tthis.PSI = psi;\n\t\tthis.options = options;\n\t\tthis.tracks = [];\n\t\tthis.adtsStream = new ADTSStream(psi);\n\t\tthis.avcStream = new AVCStream(psi);\n\t\tthis.streams = [this.adtsStream, this.avcStream];\n\n\t\tif (options.decodeCodec) {\n\t\t\tthis.avcStream.on('data', (data: GOPVector) => {\n\t\t\t\tlet stubTime = options.config.stubTime;\n\n\t\t\t\tif (isNumber(stubTime)) {\n\t\t\t\t\tlet end = (data.firstPTS + data.duration) / 90000;\n\t\t\t\t\tif (end < stubTime) {\n\t\t\t\t\t\tlogger.warn(`drop avc gop, start/end/stubTime(${data.firstPTS}/${end}/${stubTime})`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.tracks.push(data);\n\t\t\t\tthis.emit('data', this.tracks);\n\t\t\t\tthis.tracks = [];\n\t\t\t\tthis.adtsStream.flush();\n\t\t\t});\n\n\t\t\tthis.adtsStream.on('data', (data) => {\n\t\t\t\tlet stubTime = options.config.stubTime;\n\n\t\t\t\tif (isNumber(stubTime)) {\n\t\t\t\t\tlet end = (data.firstPTS + data.duration) / 90000;\n\t\t\t\t\tif (end < stubTime) {\n\t\t\t\t\t\tlogger.warn(`drop adts, start/end/stubTime(${data.firstPTS}/${end}/${stubTime})`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.tracks.push(data);\n\t\t\t\tthis.emit('data', this.tracks);\n\t\t\t\tthis.tracks = [];\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Push a complete pes\n\t * @param data\n\t */\n\tpush(data: PESStreamEmitData): void {\n\t\tconst { options, adtsStream, avcStream } = this;\n\t\tlet { stream_type } = data;\n\n\t\tif (options.decodeCodec) {\n\t\t\tswitch (stream_type) {\n\t\t\t\tcase StreamType.H264:\n\t\t\t\tcase StreamType.HEVC:\n\t\t\t\t\tavcStream.push(data);\n\t\t\t\t\tbreak;\n\t\t\t\tcase StreamType.ADTS:\n\t\t\t\t\tadtsStream.push(data);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlogger.warn(`ts elementary encounter unknown stream type ${stream_type}`);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.emit('data', data);\n\t\t}\n\t}\n\n\tflush(): void {\n\t\tlet { streams, tracks } = this;\n\t\tfor (let i = 0; i < this.streams.length; i++) {\n\t\t\tlet stream = streams[i];\n\n\t\t\tstream.flush();\n\t\t}\n\n\t\tif (tracks.length > 0) {\n\t\t\tthis.emit('data', tracks);\n\t\t}\n\n\t\tthis.emit('done');\n\n\t\ttracks.splice(0, tracks.length);\n\t}\n\n\treset(): void {\n\t\tthis.tracks = [];\n\n\t\tfor (let i = 0; i < this.streams.length; i++) {\n\t\t\tlet stream = this.streams[i];\n\n\t\t\tstream.reset();\n\t\t}\n\n\t\tthis.emit('reset');\n\t}\n}\n\nexport default ElementaryStream;\n","/**\n * @file: pes.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport DataViewReader from '../../util/dv';\n\n/**\n * @extends DataViewReader\n */\nclass Pes extends DataViewReader {\n\tstart_code_prefix: number;\n\tstream_id: number;\n\tpacket_length: number;\n\tdata_alignment_indicator: number;\n\tcopyright: number;\n\tPTS_DTS_flags: number;\n\tESCR_flag: number;\n\tES_rate_flag: number;\n\ttrick_mode_flag: number;\n\tadditional_copy_info_flag: number;\n\tCRC_flag: number;\n\textension_flag: number;\n\theader_data_length: number;\n\tPTS: number;\n\tDTS: number;\n\tdata_byte: Uint8Array;\n\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\t// The packet_start_code_prefix is a 24-bit code.\n\t\tthis.start_code_prefix = (this.readUint16(buffer, 0) << 8) | buffer[2];\n\n\t\t// In Transport Streams,\n\t\t// the stream_id may be set to any valid value which correctly describes the elementary stream type.\n\t\t// the elementary stream type is specified in the PSI(Program Specific Information).\n\t\tthis.stream_id = buffer[3];\n\n\t\t// A 16-bit field specifying the number of bytes in the PES packet.\n\t\tthis.packet_length = this.readUint16(buffer, 4);\n\n\t\tthis.data_alignment_indicator = buffer[6] & 0x04;\n\n\t\tthis.copyright = buffer[6] & 0x02;\n\n\t\t// PTS (presentation time stamp)\n\t\t// DTS (decoding time stamp)\n\t\tthis.PTS_DTS_flags = buffer[7] >> 6;\n\n\t\t// ESCR (Elementary Stream Clock Reference system):\n\t\t// A time stamp in the PES Stream from which decoders of PES streams may derive timing.\n\t\tthis.ESCR_flag = buffer[7] & 0x20;\n\n\t\tthis.ES_rate_flag = buffer[7] & 0x10;\n\n\t\tthis.trick_mode_flag = buffer[7] & 0x08;\n\n\t\tthis.additional_copy_info_flag = buffer[7] & 0x04;\n\n\t\tthis.CRC_flag = buffer[7] & 0x02;\n\n\t\tthis.extension_flag = buffer[7] & 0x01;\n\n\t\tthis.header_data_length = buffer[8];\n\n\t\tthis.PTS = 0;\n\t\tif ((this.PTS_DTS_flags & 0x02) == 0x02) {\n\t\t\tthis.PTS = this.calcTimestamp_(buffer, 9);\n\t\t}\n\n\t\t// if there is no dts, let DTS=PTS\n\t\t// See Annex D - D.0.2 Audio and Video Presentation Synchronization\n\t\tthis.DTS = this.PTS;\n\n\t\tif ((this.PTS_DTS_flags & 0x01) == 0x01) {\n\t\t\tthis.DTS = this.calcTimestamp_(buffer, 14);\n\t\t}\n\n\t\t// if (this.ESCR_flag === 1) {\n\t\t// }\n\t\t//\n\t\t// if (this.ES_rate_flag === 1) {\n\t\t// }\n\t\t//\n\t\t//\n\t\t// if (this.trick_mode_flag === 1) {\n\t\t//\n\t\t// }\n\t\t//\n\t\t// if (this.ESCR_flag === 1) {\n\t\t// }\n\n\t\tthis.data_byte = buffer.subarray(9 + this.header_data_length);\n\n\t\t// this.isStartPes = (buffer[0] << 16 | buffer[1] << 8 | buffer[2]) & 0xffffff === 0x000001;\n\t}\n\n\t/**\n\t * @param buffer\n\t * @param start\n\t */\n\tprivate calcTimestamp_(buffer: Uint8Array, start: number): number {\n\t\t// PTS / DTS is 33 bit\n\t\treturn (\n\t\t\t// JS Bitwise operators treat their operands as a sequence of 32 bits,\n\t\t\t// We cannot use bitwise operator in JS beyond 32bits\n\t\t\t(buffer[start] & 0x0e) * 536870912 + // Math.pow(2, 29) === 536870912\n\t\t\t(buffer[start + 1] << 22) +\n\t\t\t((buffer[start + 2] >> 1) << 15) +\n\t\t\t(buffer[start + 3] << 7) +\n\t\t\t(buffer[start + 4] >> 1)\n\t\t);\n\t}\n\n\tvalid(): boolean {\n\t\tlet start_code_prefix = this.start_code_prefix;\n\n\t\treturn start_code_prefix[0] === 0x00 && start_code_prefix[1] === 0x00 && start_code_prefix[2] === 0x01;\n\t}\n}\n\nexport default Pes;\n","/**\n * @file: pes.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * Packetized Elementary Stream.\n */\nimport { Context } from '../../types/globals';\nimport CacheBuffer from '../../util/cache-buffer';\nimport Stream from '../../util/stream';\nimport PSI from '../psi';\nimport Packet from '../structs/packet';\nimport PES from '../structs/pes';\nimport { PESStreamEmitData } from '../types/pipeline';\n\nclass PesStream extends Stream {\n\tprivate context: Context;\n\tprivate PSI: PSI;\n\tprivate PID?: number;\n\tprivate cache_buffer: CacheBuffer;\n\n\tconstructor(ctx: Context, psi: PSI) {\n\t\tsuper();\n\n\t\tthis.context = ctx;\n\t\tthis.PSI = psi;\n\t\tthis.PID = null;\n\t\tthis.cache_buffer = new CacheBuffer();\n\t}\n\n\t/**\n\t * @param packet\n\t */\n\tpush(packet: Packet) {\n\t\tconst self = this;\n\n\t\t// PES PID\n\t\tif (packet.PID > 0x00ff && packet.PID < 0x1fff) {\n\t\t\tif (this.PSI.currentProgramPID == -1) {\n\t\t\t\tself._pushPacket(packet);\n\t\t\t} else if (this.PSI.currentProgramPID !== packet.PID) {\n\t\t\t\tif (packet.payload_unit_start_indicator === 1) {\n\t\t\t\t\tself._assembleOnePES();\n\t\t\t\t}\n\n\t\t\t\tself._pushPacket(packet);\n\t\t\t}\n\t\t}\n\t}\n\n\tflush() {\n\t\tconst self = this;\n\n\t\t// 组装最后一个PES\n\t\tself._assembleOnePES();\n\n\t\tself.emit('done');\n\t}\n\n\treset() {\n\t\tthis._clearCached();\n\n\t\tthis.emit('reset');\n\t}\n\n\t_clearCached() {\n\t\tthis.PID = null;\n\t\tthis.cache_buffer.clear();\n\t}\n\n\t_pushPacket(p) {\n\t\tlet empty = this.cache_buffer.empty;\n\n\t\t// Make first packet in cache is start unit.\n\t\tif (empty && p.payload_unit_start_indicator === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (empty) {\n\t\t\tthis.PID = p.PID;\n\t\t}\n\n\t\tthis.cache_buffer.append(p.payload);\n\t}\n\n\t_assembleOnePES() {\n\t\tconst self = this;\n\n\t\tif (!this.cache_buffer.empty) {\n\t\t\tlet bytes;\n\n\t\t\ttry {\n\t\t\t\tbytes = this.cache_buffer.toNewBytes();\n\t\t\t} catch (e) {\n\t\t\t\tthrow `pes alloc mem err ${this.cache_buffer.byteLength}`;\n\t\t\t}\n\n\t\t\tlet pesData = new PES(bytes);\n\t\t\tlet track = this.PSI.findTrack(this.PID);\n\n\t\t\t// console.log(`stream_id: ${pesData.stream_id}, PTS: ${pesData.PTS}, DTS: ${pesData.DTS}`);\n\n\t\t\tif (track) {\n\t\t\t\tlet data: PESStreamEmitData = {\n\t\t\t\t\tpid: track.id,\n\t\t\t\t\tstream_type: track.stream_type,\n\t\t\t\t\tpcr_pid: track.pcr_pid,\n\t\t\t\t\tpes: pesData\n\t\t\t\t};\n\t\t\t\t// Assemble one pes packet, emit it to next stream.\n\t\t\t\tself.emit('data', data);\n\t\t\t}\n\n\t\t\tself._clearCached();\n\t\t}\n\t}\n}\n\nexport default PesStream;\n","/**\n * @file: packet.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * packet structure.\n */\nimport DataViewReader from '../../util/dv';\n\nconst SYNC_BYTE = 0x47; // The sync_byte is a fixed 8-bit field whose value is '0100 0111' (0x47).\n\n/**\n * @extends DataViewReader\n */\nclass Packet extends DataViewReader {\n\tsync_byte: number;\n\ttransport_error_indicator: number;\n\tpayload_unit_start_indicator: number;\n\ttransport_priority: number;\n\tPID: number;\n\ttsc: number;\n\tafc: number;\n\tcontinuity_counter: number;\n\thas_payload: number;\n\thas_adaptation: number;\n\t// is_discontinuity: boolean;\n\tpayload: Uint8Array;\n\n\t/**\n\t * @param buffer\n\t */\n\tconstructor(buffer: Uint8Array) {\n\t\tsuper();\n\n\t\tthis.sync_byte = buffer[0];\n\n\t\tthis.transport_error_indicator = buffer[1] >> 7;\n\n\t\t// Indicating transport stream packets carry PES packets or PSI data\n\t\t// PES: 1 -> commence with the first byte of a PES packet,  0 -> no PES packet shall start in this packet.\n\t\t// PSI: 1 -> carries the first byte of a PSI section, 0 -> no pointer_field in the payload.\n\t\tthis.payload_unit_start_indicator = (buffer[1] >> 6) & 1;\n\n\t\tthis.transport_priority = (buffer[1] >>> 5) & 1;\n\n\t\t// The PID(Packet ID) is a 13-bit field, indicating the type of the data stored in the packet payload.\n\t\t// NOTE – The transport packets with PID values 0x0000, 0x0001, and 0x0010-0x1FFE are allowed to carry a PCR.\n\t\t// ISO/IEC 13818-1 : 2000 (E)\n\t\t// Value                  Description\n\t\t// 0x0000                 Program Association Table\n\t\t// 0x0001                 Conditional Access Table\n\t\t// 0x0002                 Transport Stream Description Table\n\t\t// 0x0003-0x000F          Reserved\n\t\t// 0x0010 ... 0x1FFE      May be assigned as network_PID, Program_map_PID, elementary_PID, or for other purposes\n\t\t// https://www.dvb.org/resources/public/standards/a38_dvb-si_specification.pdf\n\t\t// 0x0040                 Network_information_section-actual_network\n\t\t// 0x0041                 Network_information_section-other_network\n\t\t// 0x0042                 Service_description_section-actual_transport_stream\n\t\t// 0x0043                 TO 0x45 Reserved for future use\n\t\t// 0x0046                 Service_description_section-other_transport_stream\n\t\t// 0x0047                 TO 0x49 Reserved for future use\n\t\t// 0x004A                 Bouquet_association_section\n\t\t// 0x004B                 TO 0x4D Reserved for future use\n\t\t// 0x004E                 Event_information_section-actual_transport_stream,P/F\n\t\t// 0x004F                 Event_information_section-other_transport_stream,P/F\n\t\t// 0x0050                 TO 0x5F Event_information_section-actual_transport_stream,schedule\n\t\t// 0x0060                 TO 0x6F Event_information_section-other_transport_stream,schedule\n\t\t// 0x0070                 Time_data_section\n\t\t// 0x0071                 Running_status_section\n\t\t// 0x0072                 Stuffing_section\n\t\t// 0x0073                 Time_offset_section\n\t\t// 0x0074                 TO 0x007D Reserved for future use\n\t\t// 0x007E                 Discontinuity_information_section\n\t\t// 0x007F                 Selection_information_section\n\t\t// 0x0080                 TO 0x00FE User defined\n\t\t// 0x00FF                 Reserved\n\t\t// 0x1FFF                 Null packet\n\t\tthis.PID = this.readUint16(buffer, 1) & 0x1fff;\n\n\t\t// transport_scrambling_control\n\t\tthis.tsc = buffer[3] >> 6;\n\n\t\t// adaptation_field_control\n\t\t// Value  Description\n\t\t// 00     Reserved for future use by ISO/IEC\n\t\t// 01     No adaptation_field, payload only\n\t\t// 10     Adaptation_field only, no payload\n\t\t// 11     Adaptation_field followed by payload\n\t\tthis.afc = (buffer[3] >> 4) & 3;\n\n\t\t// '1' indicates that the discontinuity state is true for the current Transport Stream packet.\n\t\t// continuity_counter\n\t\tthis.continuity_counter = buffer[3] & 0xf;\n\n\t\t// self defines.\n\t\tthis.has_payload = this.afc & 1;\n\t\tthis.has_adaptation = this.afc & 2;\n\t\t// this.is_discontinuity = this.has_adaptation && buffer[4] != 0 /* with length > 0 */ && buffer[5] & 0x80;\n\t\t/* and discontinuity indicated */\n\n\t\tif (this.has_payload) {\n\t\t\tif (this.has_adaptation) {\n\t\t\t\tlet adaptation_field_length = buffer[4];\n\t\t\t\tthis.payload = buffer.subarray(5 + adaptation_field_length);\n\t\t\t} else {\n\t\t\t\tthis.payload = buffer.subarray(4);\n\t\t\t}\n\t\t}\n\t}\n\n\tvalid(): boolean {\n\t\tlet val = this.sync_byte === SYNC_BYTE && this.has_payload === 1;\n\t\treturn val;\n\t}\n}\n\nexport default Packet;\n","/**\n * @file: demux.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/**\n * MPEG-2 transport stream demuxer.\n */\nimport DemuxFacade from '../demux-facade';\nimport muxErrorCode from '../mux-error-code';\nimport { GlobalOptions, PushConf } from '../types/globals';\nimport logger from '../util/logger';\nimport PSI from './psi';\nimport M2TSComplexStream from './streams/complex';\nimport ElementaryStream from './streams/elementary';\nimport PesStream from './streams/pes';\nimport Packet from './structs/packet';\n\nconst CHUNK_BYTE_LENGTH = 188; // Transport Stream chunks shall be 188 bytes long.\n\ntype InterfaceStream = M2TSComplexStream | ElementaryStream;\n\nexport class TSDemux extends DemuxFacade {\n\tprivate psi_: PSI;\n\tprivate pesStream_: PesStream;\n\tprivate elementaryStream_: ElementaryStream;\n\tprivate complexStream_: M2TSComplexStream;\n\n\tconstructor(options: GlobalOptions = {}) {\n\t\tsuper(options);\n\n\t\tthis.psi_ = new PSI(this.ctx_);\n\t\tthis.pesStream_ = new PesStream(this.ctx_, this.psi_);\n\t\tthis.elementaryStream_ = new ElementaryStream(this.ctx_, this.psi_, options);\n\t\tthis.complexStream_ = new M2TSComplexStream(this.ctx_, this.psi_);\n\n\t\t// Compose pipeline\n\t\tthis.pipe(this.pesStream_);\n\t\tthis.pesStream_.pipe(this.elementaryStream_);\n\t\tthis.elementaryStream_.pipe(this.complexStream_);\n\n\t\tsuper.listenEndStream_();\n\t}\n\n\t/**\n\t * This is end pipeline stream\n\t */\n\tget endStream(): InterfaceStream {\n\t\tlet stream: InterfaceStream = this.elementaryStream_;\n\n\t\tif (this.options_.decodeCodec) {\n\t\t\tstream = this.complexStream_;\n\t\t}\n\n\t\treturn stream;\n\t}\n\n\t/**\n\t * TS push support streaming incomplete data push.\n\t * @param buffer\n\t * @param conf\n\t * @param conf.done - If you need the done event, this boolean needs to be set\n\t */\n\tpush(buffer: ArrayBuffer | Uint8Array, conf: PushConf) {\n\t\tconst { done } = conf;\n\t\tconst { options_, ctx_, cache_buffer_, psi_ } = this;\n\t\tlet newBuf: Uint8Array = super.constraintPushData_(buffer);\n\t\tlet cacheByteLength = cache_buffer_.byteLength;\n\t\tlet byteOffset = null;\n\n\t\toptions_.config = conf;\n\n\t\tlogger.log(\n\t\t\t`hls demux received ${newBuf.byteLength} bytes, cache ${cacheByteLength} bytes. ${done ? 'chunk done' : ''}`\n\t\t);\n\n\t\tcache_buffer_.append(newBuf);\n\n\t\twhile (cache_buffer_.byteLength >= CHUNK_BYTE_LENGTH) {\n\t\t\tlet chunk = cache_buffer_.cut(CHUNK_BYTE_LENGTH);\n\n\t\t\t// The pushed buffer may be so small that can't cut a ts chunk.\n\t\t\tif (chunk) {\n\t\t\t\tlet packet = new Packet(chunk);\n\n\t\t\t\tif (packet.valid()) {\n\t\t\t\t\tpsi_.parse(packet);\n\n\t\t\t\t\tthis.emit('data', packet);\n\t\t\t\t} else {\n\t\t\t\t\tlet errMsg = `Encounter invalid ts packet, packet_length(${chunk.length}), cache_length(${this.cache_buffer_.byteLength}), has_payload(${packet.has_payload}), data(${chunk})`;\n\n\t\t\t\t\tlogger.error(errMsg);\n\n\t\t\t\t\tthis.reset();\n\n\t\t\t\t\tctx_.emit('error', muxErrorCode.TS_SYNC_BYTE, errMsg, {\n\t\t\t\t\t\tstartByte: byteOffset,\n\t\t\t\t\t\tendByte: byteOffset + chunk.byteLength\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbyteOffset += chunk.byteLength;\n\t\t\t}\n\t\t}\n\n\t\tif (cache_buffer_.empty && done) {\n\t\t\t// logger.log('mux packet done!');\n\t\t\tthis.emit('done');\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.cache_buffer_.clear();\n\n\t\tthis.emit('reset');\n\t}\n}\n","/**\n * @file: mp4-inspector.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\n/* eslint-disable */\nlet /**\n\t * Returns the string representation of an ASCII encoded four byte buffer.\n\t * @param buffer - a four-byte buffer to translate\n\t * @return the corresponding string\n\t */\n\tparseType = function (buffer: Uint8Array): string {\n\t\tlet result = '';\n\t\tresult += String.fromCharCode(buffer[0]);\n\t\tresult += String.fromCharCode(buffer[1]);\n\t\tresult += String.fromCharCode(buffer[2]);\n\t\tresult += String.fromCharCode(buffer[3]);\n\t\treturn result;\n\t},\n\tparseMp4Date = function (seconds: number): Date {\n\t\treturn new Date(seconds * 1000 - 2082844800000);\n\t},\n\tparseSampleFlags = function (flags: Uint8Array) {\n\t\treturn {\n\t\t\tisLeading: (flags[0] & 0x0c) >>> 2,\n\t\t\tdependsOn: flags[0] & 0x03,\n\t\t\tisDependedOn: (flags[1] & 0xc0) >>> 6,\n\t\t\thasRedundancy: (flags[1] & 0x30) >>> 4,\n\t\t\tpaddingValue: (flags[1] & 0x0e) >>> 1,\n\t\t\tisNonSyncSample: flags[1] & 0x01,\n\t\t\tdegradationPriority: (flags[2] << 8) | flags[3]\n\t\t};\n\t},\n\tnalParse = function (avcStream) {\n\t\tlet avcView = new DataView(avcStream.buffer, avcStream.byteOffset, avcStream.byteLength),\n\t\t\tresult = [],\n\t\t\ti,\n\t\t\tlength;\n\t\tfor (i = 0; i < avcStream.length; i += length) {\n\t\t\tlength = avcView.getUint32(i);\n\t\t\ti += 4;\n\t\t\tswitch (avcStream[i] & 0x1f) {\n\t\t\t\tcase 0x01:\n\t\t\t\t\tresult.push('NDR');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x05:\n\t\t\t\t\tresult.push('IDR');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x06:\n\t\t\t\t\tresult.push('SEI');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x07:\n\t\t\t\t\tresult.push('SPS');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x08:\n\t\t\t\t\tresult.push('PPS');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x09:\n\t\t\t\t\tresult.push('AUD');\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tresult.push(avcStream[i] & 0x1f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\t// registry of handlers for individual mp4 box types\n\tparse = {\n\t\t// codingname, not a first-class box type. stsd entries share the\n\t\t// same format as real boxes so the parsing infrastructure can be\n\t\t// shared\n\t\tavc1: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tdataReferenceIndex: view.getUint16(6),\n\t\t\t\twidth: view.getUint16(24),\n\t\t\t\theight: view.getUint16(26),\n\t\t\t\thorizresolution: view.getUint16(28) + view.getUint16(30) / 16,\n\t\t\t\tvertresolution: view.getUint16(32) + view.getUint16(34) / 16,\n\t\t\t\tframeCount: view.getUint16(40),\n\t\t\t\tdepth: view.getUint16(74),\n\t\t\t\tconfig: mp4toJSON(data.subarray(78, data.byteLength))\n\t\t\t};\n\t\t},\n\t\tavcC: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tconfigurationVersion: data[0],\n\t\t\t\t\tavcProfileIndication: data[1],\n\t\t\t\t\tprofileCompatibility: data[2],\n\t\t\t\t\tavcLevelIndication: data[3],\n\t\t\t\t\tlengthSizeMinusOne: data[4] & 0x03,\n\t\t\t\t\tsps: [],\n\t\t\t\t\tpps: []\n\t\t\t\t},\n\t\t\t\tnumOfSequenceParameterSets = data[5] & 0x1f,\n\t\t\t\tnumOfPictureParameterSets,\n\t\t\t\tnalSize,\n\t\t\t\toffset,\n\t\t\t\ti;\n\n\t\t\t// iterate past any SPSs\n\t\t\toffset = 6;\n\t\t\tfor (i = 0; i < numOfSequenceParameterSets; i++) {\n\t\t\t\tnalSize = view.getUint16(offset);\n\t\t\t\toffset += 2;\n\t\t\t\tresult.sps.push(new Uint8Array(data.subarray(offset, offset + nalSize)));\n\t\t\t\toffset += nalSize;\n\t\t\t}\n\t\t\t// iterate past any PPSs\n\t\t\tnumOfPictureParameterSets = data[offset];\n\t\t\toffset++;\n\t\t\tfor (i = 0; i < numOfPictureParameterSets; i++) {\n\t\t\t\tnalSize = view.getUint16(offset);\n\t\t\t\toffset += 2;\n\t\t\t\tresult.pps.push(new Uint8Array(data.subarray(offset, offset + nalSize)));\n\t\t\t\toffset += nalSize;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tbtrt: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tbufferSizeDB: view.getUint32(0),\n\t\t\t\tmaxBitrate: view.getUint32(4),\n\t\t\t\tavgBitrate: view.getUint32(8)\n\t\t\t};\n\t\t},\n\t\tesds: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tesId: (data[6] << 8) | data[7],\n\t\t\t\tstreamPriority: data[8] & 0x1f,\n\t\t\t\tdecoderConfig: {\n\t\t\t\t\tobjectProfileIndication: data[11],\n\t\t\t\t\tstreamType: (data[12] >>> 2) & 0x3f,\n\t\t\t\t\tbufferSize: (data[13] << 16) | (data[14] << 8) | data[15],\n\t\t\t\t\tmaxBitrate: (data[16] << 24) | (data[17] << 16) | (data[18] << 8) | data[19],\n\t\t\t\t\tavgBitrate: (data[20] << 24) | (data[21] << 16) | (data[22] << 8) | data[23],\n\t\t\t\t\tdecoderConfigDescriptor: {\n\t\t\t\t\t\ttag: data[24],\n\t\t\t\t\t\tlength: data[25],\n\t\t\t\t\t\t// audioObjectType: (data[26] >>> 3) & 0x1f,\n\t\t\t\t\t\t// samplingFrequencyIndex: ((data[26] & 0x07) << 1) |\n\t\t\t\t\t\t//   ((data[27] >>> 7) & 0x01),\n\t\t\t\t\t\t// channelConfiguration: (data[27] >>> 3) & 0x0f,\n\t\t\t\t\t\t// FIXME\n\t\t\t\t\t\taudioObjectType: (data[35] >>> 3) & 0x1f,\n\t\t\t\t\t\tsamplingFrequencyIndex: ((data[35] & 0x07) << (8 + (data[36] & 0x80))) >> 7,\n\t\t\t\t\t\tchannelConfiguration: (data[36] & 0x78) >> 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tftyp: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tmajorBrand: parseType(data.subarray(0, 4)),\n\t\t\t\t\tminorVersion: view.getUint32(4),\n\t\t\t\t\tcompatibleBrands: []\n\t\t\t\t},\n\t\t\t\ti = 8;\n\t\t\twhile (i < data.byteLength) {\n\t\t\t\tresult.compatibleBrands.push(parseType(data.subarray(i, i + 4)));\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tdinf: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tdref: function (data) {\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tdataReferences: mp4toJSON(data.subarray(8))\n\t\t\t};\n\t\t},\n\t\thdlr: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tversion: view.getUint8(0),\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\thandlerType: parseType(data.subarray(8, 12)),\n\t\t\t\t\tname: ''\n\t\t\t\t},\n\t\t\t\ti = 8;\n\n\t\t\t// parse out the name field\n\t\t\tfor (i = 24; i < data.byteLength; i++) {\n\t\t\t\tif (data[i] === 0x00) {\n\t\t\t\t\t// the name field is null-terminated\n\t\t\t\t\ti++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tresult.name += String.fromCharCode(data[i]);\n\t\t\t}\n\t\t\t// decode UTF-8 to javascript's internal representation\n\t\t\t// see http://ecmanaut.blogspot.com/2006/07/encoding-decoding-utf8-in-javascript.html\n\t\t\tresult.name = decodeURIComponent(decodeURIComponent(result.name));\n\n\t\t\treturn result;\n\t\t},\n\t\t// mdat: function(data) {\n\t\t// \treturn {\n\t\t// \t\tbyteLength: data.byteLength,\n\t\t// \t\tnals: nalParse(data),\n\t\t// \t\trealData: data\n\t\t// \t};\n\t\t// },\n\t\tmdhd: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\ti = 4,\n\t\t\t\tlanguage,\n\t\t\t\tresult = {\n\t\t\t\t\tversion: view.getUint8(0),\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tlanguage: '',\n\t\t\t\t\tcreationTime: new Date(),\n\t\t\t\t\tmodificationTime: new Date(),\n\t\t\t\t\ttimescale: 0,\n\t\t\t\t\tduration: 0\n\t\t\t\t};\n\t\t\tif (result.version === 1) {\n\t\t\t\ti += 4;\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 8;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 4;\n\t\t\t\tresult.timescale = view.getUint32(i);\n\t\t\t\ti += 8;\n\t\t\t\tresult.duration = view.getUint32(i); // truncating top 4 bytes\n\t\t\t} else {\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.timescale = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t\tresult.duration = view.getUint32(i);\n\t\t\t}\n\t\t\ti += 4;\n\t\t\t// language is stored as an ISO-639-2/T code in an array of three 5-bit fields\n\t\t\t// each field is the packed difference between its ASCII value and 0x60\n\t\t\tlanguage = view.getUint16(i);\n\t\t\tresult.language += String.fromCharCode((language >> 10) + 0x60);\n\t\t\tresult.language += String.fromCharCode(((language & 0x03c0) >> 5) + 0x60);\n\t\t\tresult.language += String.fromCharCode((language & 0x1f) + 0x60);\n\n\t\t\treturn result;\n\t\t},\n\t\tmdia: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tmfhd: function (data) {\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tsequenceNumber: (data[4] << 24) | (data[5] << 16) | (data[6] << 8) | data[7]\n\t\t\t};\n\t\t},\n\t\tminf: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\t// codingname, not a first-class box type. stsd entries share the\n\t\t// same format as real boxes so the parsing infrastructure can be\n\t\t// shared\n\t\tmp4a: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\t// 6 bytes reserved\n\t\t\t\t\tdataReferenceIndex: view.getUint16(6),\n\t\t\t\t\t// 4 + 4 bytes reserved\n\t\t\t\t\tchannelcount: view.getUint16(16),\n\t\t\t\t\tsamplesize: view.getUint16(18),\n\t\t\t\t\t// 2 bytes pre_defined\n\t\t\t\t\t// 2 bytes reserved\n\t\t\t\t\tsamplerate: view.getUint16(24) + view.getUint16(26) / 65536,\n\t\t\t\t\tstreamDescriptor: undefined\n\t\t\t\t};\n\n\t\t\t// if there are more bytes to process, assume this is an ISO/IEC\n\t\t\t// 14496-14 MP4AudioSampleEntry and parse the ESDBox\n\t\t\tif (data.byteLength > 28) {\n\t\t\t\tresult.streamDescriptor = mp4toJSON(data.subarray(28))[0];\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tmoof: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tmoov: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tmvex: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tmvhd: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\ti = 4,\n\t\t\t\tresult = {\n\t\t\t\t\tversion: view.getUint8(0),\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tcreationTime: new Date(),\n\t\t\t\t\tmodificationTime: new Date(),\n\t\t\t\t\ttimescale: 0,\n\t\t\t\t\tduration: 0,\n\t\t\t\t\trate: 0,\n\t\t\t\t\tvolume: 0,\n\t\t\t\t\tmatrix: new Uint32Array(0),\n\t\t\t\t\tnextTrackId: 0\n\t\t\t\t};\n\n\t\t\tif (result.version === 1) {\n\t\t\t\ti += 4;\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 8;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 4;\n\t\t\t\tresult.timescale = view.getUint32(i);\n\t\t\t\ti += 8;\n\t\t\t\tresult.duration = view.getUint32(i); // truncating top 4 bytes\n\t\t\t} else {\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.timescale = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t\tresult.duration = view.getUint32(i);\n\t\t\t}\n\t\t\ti += 4;\n\n\t\t\t// convert fixed-point, base 16 back to a number\n\t\t\tresult.rate = view.getUint16(i) + view.getUint16(i + 2) / 16;\n\t\t\ti += 4;\n\t\t\tresult.volume = view.getUint8(i) + view.getUint8(i + 1) / 8;\n\t\t\ti += 2;\n\t\t\ti += 2;\n\t\t\ti += 2 * 4;\n\t\t\tresult.matrix = new Uint32Array(data.subarray(i, i + 9 * 4));\n\t\t\ti += 9 * 4;\n\t\t\ti += 6 * 4;\n\t\t\tresult.nextTrackId = view.getUint32(i);\n\t\t\treturn result;\n\t\t},\n\t\tpdin: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tversion: view.getUint8(0),\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\trate: view.getUint32(4),\n\t\t\t\tinitialDelay: view.getUint32(8)\n\t\t\t};\n\t\t},\n\t\tsdtp: function (data) {\n\t\t\tlet result = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tsamples: []\n\t\t\t\t},\n\t\t\t\ti;\n\n\t\t\tfor (i = 4; i < data.byteLength; i++) {\n\t\t\t\tresult.samples.push({\n\t\t\t\t\tdependsOn: (data[i] & 0x30) >> 4,\n\t\t\t\t\tisDependedOn: (data[i] & 0x0c) >> 2,\n\t\t\t\t\thasRedundancy: data[i] & 0x03\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tsidx: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\treferences: [],\n\t\t\t\t\treferenceId: view.getUint32(4),\n\t\t\t\t\ttimescale: view.getUint32(8),\n\t\t\t\t\tearliestPresentationTime: view.getUint32(12),\n\t\t\t\t\tfirstOffset: view.getUint32(16)\n\t\t\t\t},\n\t\t\t\treferenceCount = view.getUint16(22),\n\t\t\t\ti;\n\n\t\t\tfor (i = 24; referenceCount; i += 12, referenceCount--) {\n\t\t\t\tresult.references.push({\n\t\t\t\t\treferenceType: (data[i] & 0x80) >>> 7,\n\t\t\t\t\treferencedSize: view.getUint32(i) & 0x7fffffff,\n\t\t\t\t\tsubsegmentDuration: view.getUint32(i + 4),\n\t\t\t\t\tstartsWithSap: !!(data[i + 8] & 0x80),\n\t\t\t\t\tsapType: (data[i + 8] & 0x70) >>> 4,\n\t\t\t\t\tsapDeltaTime: view.getUint32(i + 8) & 0x0fffffff\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tstbl: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\tstco: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\tlet entryCount = view.getUint32(4);\n\t\t\tlet result = {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tentryCount: entryCount,\n\t\t\t\tchunkOffsets: []\n\t\t\t};\n\t\t\tfor (let i = 8; entryCount; i += 4, entryCount--) {\n\t\t\t\tresult.chunkOffsets.push(view.getUint32(i));\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tstsc: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tentryCount = view.getUint32(4),\n\t\t\t\tresult = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tsampleToChunks: []\n\t\t\t\t},\n\t\t\t\ti;\n\t\t\tfor (i = 8; entryCount; i += 12, entryCount--) {\n\t\t\t\tresult.sampleToChunks.push({\n\t\t\t\t\tfirstChunk: view.getUint32(i),\n\t\t\t\t\tsamplesPerChunk: view.getUint32(i + 4),\n\t\t\t\t\tsampleDescriptionIndex: view.getUint32(i + 8)\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tstsd: function (data) {\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tboxes: mp4toJSON(data.subarray(8))\n\t\t\t};\n\t\t},\n\t\tstsz: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tsampleSize: view.getUint32(4),\n\t\t\t\t\tentries: []\n\t\t\t\t},\n\t\t\t\ti;\n\t\t\tfor (i = 12; i < data.byteLength; i += 4) {\n\t\t\t\tresult.entries.push(view.getUint32(i));\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tstts: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\ttimeToSamples: []\n\t\t\t\t},\n\t\t\t\tentryCount = view.getUint32(4),\n\t\t\t\ti;\n\n\t\t\tfor (i = 8; entryCount; i += 8, entryCount--) {\n\t\t\t\tresult.timeToSamples.push({\n\t\t\t\t\tsampleCount: view.getUint32(i),\n\t\t\t\t\tsampleDelta: view.getUint32(i + 4)\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tstyp: function (data) {\n\t\t\treturn parse.ftyp(data);\n\t\t},\n\t\ttfdt: function (data) {\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\tbaseMediaDecodeTime: (data[4] << 24) | (data[5] << 16) | (data[6] << 8) | data[7]\n\t\t\t};\n\t\t},\n\t\ttfhd: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tresult: {\n\t\t\t\t\tversion: number;\n\t\t\t\t\tflags: Uint8Array;\n\t\t\t\t\ttrackId: number;\n\t\t\t\t\tbaseDataOffset?: number;\n\t\t\t\t\tsampleDescriptionIndex?: number;\n\t\t\t\t\tdefaultSampleDuration?: number;\n\t\t\t\t\tdefaultSampleSize?: number;\n\t\t\t\t\tdefaultSampleFlags?: number;\n\t\t\t\t} = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\ttrackId: view.getUint32(4)\n\t\t\t\t},\n\t\t\t\tbaseDataOffsetPresent = result.flags[2] & 0x01,\n\t\t\t\tsampleDescriptionIndexPresent = result.flags[2] & 0x02,\n\t\t\t\tdefaultSampleDurationPresent = result.flags[2] & 0x08,\n\t\t\t\tdefaultSampleSizePresent = result.flags[2] & 0x10,\n\t\t\t\tdefaultSampleFlagsPresent = result.flags[2] & 0x20,\n\t\t\t\ti;\n\n\t\t\ti = 8;\n\t\t\tif (baseDataOffsetPresent) {\n\t\t\t\ti += 4; // truncate top 4 bytes\n\t\t\t\tresult.baseDataOffset = view.getUint32(12);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tif (sampleDescriptionIndexPresent) {\n\t\t\t\tresult.sampleDescriptionIndex = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tif (defaultSampleDurationPresent) {\n\t\t\t\tresult.defaultSampleDuration = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tif (defaultSampleSizePresent) {\n\t\t\t\tresult.defaultSampleSize = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tif (defaultSampleFlagsPresent) {\n\t\t\t\tresult.defaultSampleFlags = view.getUint32(i);\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\ttkhd: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\ti = 4,\n\t\t\t\tresult = {\n\t\t\t\t\tversion: view.getUint8(0),\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tcreationTime: new Date(),\n\t\t\t\t\tmodificationTime: new Date(),\n\t\t\t\t\ttrackId: 0,\n\t\t\t\t\tduration: 0,\n\t\t\t\t\tlayer: 0,\n\t\t\t\t\talternateGroup: 0,\n\t\t\t\t\tvolume: 0,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0,\n\t\t\t\t\tmatrix: new Uint32Array(0)\n\t\t\t\t};\n\t\t\tif (result.version === 1) {\n\t\t\t\ti += 4;\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 8;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i)); // truncating top 4 bytes\n\t\t\t\ti += 4;\n\t\t\t\tresult.trackId = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t\ti += 8;\n\t\t\t\tresult.duration = view.getUint32(i); // truncating top 4 bytes\n\t\t\t} else {\n\t\t\t\tresult.creationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.modificationTime = parseMp4Date(view.getUint32(i));\n\t\t\t\ti += 4;\n\t\t\t\tresult.trackId = view.getUint32(i);\n\t\t\t\ti += 4;\n\t\t\t\ti += 4;\n\t\t\t\tresult.duration = view.getUint32(i);\n\t\t\t}\n\t\t\ti += 4;\n\t\t\ti += 2 * 4;\n\t\t\tresult.layer = view.getUint16(i);\n\t\t\ti += 2;\n\t\t\tresult.alternateGroup = view.getUint16(i);\n\t\t\ti += 2;\n\t\t\t// convert fixed-point, base 16 back to a number\n\t\t\tresult.volume = view.getUint8(i) + view.getUint8(i + 1) / 8;\n\t\t\ti += 2;\n\t\t\ti += 2;\n\t\t\tresult.matrix = new Uint32Array(data.subarray(i, i + 9 * 4));\n\t\t\ti += 9 * 4;\n\t\t\tresult.width = view.getUint16(i) + view.getUint16(i + 2) / 16;\n\t\t\ti += 4;\n\t\t\tresult.height = view.getUint16(i) + view.getUint16(i + 2) / 16;\n\t\t\treturn result;\n\t\t},\n\t\ttraf: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\ttrak: function (data) {\n\t\t\treturn {\n\t\t\t\tboxes: mp4toJSON(data)\n\t\t\t};\n\t\t},\n\t\ttrex: function (data) {\n\t\t\tlet view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\ttrackId: view.getUint32(4),\n\t\t\t\tdefaultSampleDescriptionIndex: view.getUint32(8),\n\t\t\t\tdefaultSampleDuration: view.getUint32(12),\n\t\t\t\tdefaultSampleSize: view.getUint32(16),\n\t\t\t\tsampleDependsOn: data[20] & 0x03,\n\t\t\t\tsampleIsDependedOn: (data[21] & 0xc0) >> 6,\n\t\t\t\tsampleHasRedundancy: (data[21] & 0x30) >> 4,\n\t\t\t\tsamplePaddingValue: (data[21] & 0x0e) >> 1,\n\t\t\t\tsampleIsDifferenceSample: !!(data[21] & 0x01),\n\t\t\t\tsampleDegradationPriority: view.getUint16(22)\n\t\t\t};\n\t\t},\n\t\ttrun: function (data) {\n\t\t\tlet result: {\n\t\t\t\t\tversion: number;\n\t\t\t\t\tflags: Uint8Array;\n\t\t\t\t\tsamples: Array<any>;\n\t\t\t\t\tdataOffset?: number;\n\t\t\t\t} = {\n\t\t\t\t\tversion: data[0],\n\t\t\t\t\tflags: new Uint8Array(data.subarray(1, 4)),\n\t\t\t\t\tsamples: []\n\t\t\t\t},\n\t\t\t\tview = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\t\t\tdataOffsetPresent = result.flags[2] & 0x01,\n\t\t\t\tfirstSampleFlagsPresent = result.flags[2] & 0x04,\n\t\t\t\tsampleDurationPresent = result.flags[1] & 0x01,\n\t\t\t\tsampleSizePresent = result.flags[1] & 0x02,\n\t\t\t\tsampleFlagsPresent = result.flags[1] & 0x04,\n\t\t\t\tsampleCompositionTimeOffsetPresent = result.flags[1] & 0x08,\n\t\t\t\tsampleCount = view.getUint32(4),\n\t\t\t\toffset = 8,\n\t\t\t\tsample;\n\n\t\t\tif (dataOffsetPresent) {\n\t\t\t\tresult.dataOffset = view.getUint32(offset);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tif (firstSampleFlagsPresent && sampleCount) {\n\t\t\t\tsample = {\n\t\t\t\t\tflags: parseSampleFlags(data.subarray(offset, offset + 4))\n\t\t\t\t};\n\t\t\t\toffset += 4;\n\t\t\t\tif (sampleDurationPresent) {\n\t\t\t\t\tsample.duration = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (sampleSizePresent) {\n\t\t\t\t\tsample.size = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (sampleCompositionTimeOffsetPresent) {\n\t\t\t\t\tsample.compositionTimeOffset = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tresult.samples.push(sample);\n\t\t\t\tsampleCount--;\n\t\t\t}\n\t\t\twhile (sampleCount--) {\n\t\t\t\tsample = {};\n\t\t\t\tif (sampleDurationPresent) {\n\t\t\t\t\tsample.duration = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (sampleSizePresent) {\n\t\t\t\t\tsample.size = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (sampleFlagsPresent) {\n\t\t\t\t\tsample.flags = parseSampleFlags(data.subarray(offset, offset + 4));\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (sampleCompositionTimeOffsetPresent) {\n\t\t\t\t\tsample.compositionTimeOffset = view.getUint32(offset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tresult.samples.push(sample);\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\t'url ': function (data) {\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4))\n\t\t\t};\n\t\t},\n\t\tvmhd: function (data) {\n\t\t\t//let view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\t\t\treturn {\n\t\t\t\tversion: data[0],\n\t\t\t\tflags: new Uint8Array(data.subarray(1, 4))\n\t\t\t\t//graphicsmode: view.getUint16(4),\n\t\t\t\t//opcolor: new Uint16Array([view.getUint16(6),\n\t\t\t\t//                          view.getUint16(8),\n\t\t\t\t//                          view.getUint16(10)])\n\t\t\t};\n\t\t}\n\t};\n\n/**\n * Return a javascript array of box objects parsed from an ISO base media file.\n * @param data - the binary data of the media to be inspected\n * @return a javascript array of potentially nested box objects\n */\nlet mp4toJSON = function (data: Uint8Array): Array<any> {\n\tlet i = 0,\n\t\tresult = [],\n\t\tview = new DataView(data.buffer, data.byteOffset, data.byteLength),\n\t\tsize,\n\t\ttype,\n\t\tend,\n\t\tbox;\n\n\twhile (i < data.byteLength) {\n\t\t// parse box data\n\t\t(size = view.getUint32(i)), (type = parseType(data.subarray(i + 4, i + 8)));\n\t\tend = size > 1 ? i + size : data.byteLength;\n\n\t\t// parse type-specific data\n\t\tbox = (\n\t\t\tparse[type] ||\n\t\t\tfunction (data) {\n\t\t\t\treturn {\n\t\t\t\t\tdata: data\n\t\t\t\t};\n\t\t\t}\n\t\t)(data.subarray(i + 8, end));\n\t\tbox.size = size;\n\t\tbox.type = type;\n\n\t\t// store this box and move to the next\n\t\tresult.push(box);\n\t\ti = end;\n\t}\n\treturn result;\n};\n\nexport const MP4Inspect = {\n\tmp4toJSON: mp4toJSON\n};\n","/**\n * @file: demux.js, created at Monday, 23rd December 2019 3:47:23 pm\n * @copyright Copyright (c) 2020\n * @author gem <gems.xu@gmail.com>\n */\n\nimport DemuxFacade from '../demux-facade';\nimport { GlobalOptions } from '../types/globals';\nimport logger from '../util/logger';\nimport { MP4Inspect } from './mp4-inspector';\n\n/**\n * mp4.\n */\nexport class MP4Demux extends DemuxFacade {\n\tconstructor(options: GlobalOptions = {}) {\n\t\tsuper(options);\n\n\t\tsuper.listenEndStream_();\n\t}\n\n\t/**\n\t * This is end pipeline stream\n\t */\n\tget endStream() {\n\t\treturn this;\n\t}\n\n\t/**\n\t * The MP4 data pushed into stream should be complete data.\n\t * @param buffer\n\t */\n\tpush(buffer: ArrayBuffer | Uint8Array) {\n\t\tlet newBuf: Uint8Array = super.constraintPushData_(buffer);\n\n\t\tlogger.log(`mp4 demux received ${newBuf.byteLength} bytes`);\n\n\t\tlet result = MP4Inspect.mp4toJSON(newBuf);\n\n\t\tthis.emit('data', result);\n\t}\n}\n"],"names":["Events","console","global","NALUnit","AVCStream","PES"],"mappings":"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"}